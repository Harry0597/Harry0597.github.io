<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="200x200" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon32.ico">
  <link rel="icon" type="image/ico" sizes="16x16" href="/images/favicon16.ico">
  <link rel="mask-icon" href="/images/hackerrank.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.lug.ustc.edu.cn/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"harry0597.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"./public/search.xml"};
  </script>

  <meta name="description" content="2023.3.24至3.26于NKCTF赛事中所产题解。">
<meta property="og:type" content="article">
<meta property="og:title" content="NKCTF2023·Crypto WP">
<meta property="og:url" content="https://harry0597.com/2023/03/30/NKCTF2023/index.html">
<meta property="og:site_name" content="Harry&#39;s Blog">
<meta property="og:description" content="2023.3.24至3.26于NKCTF赛事中所产题解。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Harry0597/Imag@master/uPic/92f69d3a8ec71c500f531642edbc4711.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Harry0597/Imag@master/uPic/12bbf71421706859cde23cac65ed54ba.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Harry0597/Imag@master/uPic/d7e91f0fae5b720a917565d0be956497.png">
<meta property="article:published_time" content="2023-03-30T15:21:28.000Z">
<meta property="article:modified_time" content="2023-03-31T01:24:40.931Z">
<meta property="article:author" content="Harry0597">
<meta property="article:tag" content="Writeup">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/Harry0597/Imag@master/uPic/92f69d3a8ec71c500f531642edbc4711.png">

<link rel="canonical" href="https://harry0597.com/2023/03/30/NKCTF2023/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>NKCTF2023·Crypto WP | Harry's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Harry's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">温故知新</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/Harry0597" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://harry0597.com/2023/03/30/NKCTF2023/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/IMG_2550.JPG">
      <meta itemprop="name" content="Harry0597">
      <meta itemprop="description" content="Pondering'll do you wonders.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Harry's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          NKCTF2023·Crypto WP
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-03-30 23:21:28" itemprop="dateCreated datePublished" datetime="2023-03-30T23:21:28+08:00">2023-03-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-03-31 09:24:40" itemprop="dateModified" datetime="2023-03-31T09:24:40+08:00">2023-03-31</time>
              </span>

          
    <span>&emsp;</span><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span>
    <span class="post-meta-item-text">阅读次数：</span>
    <span id="busuanzi_value_page_pv"></span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2023/03/30/NKCTF2023/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/03/30/NKCTF2023/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>72k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1:05</span>
            </span>
            <div class="post-description">2023.3.24至3.26于NKCTF赛事中所产题解。</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="NKCTF2023"><a href="#NKCTF2023" class="headerlink" title="NKCTF2023"></a>NKCTF2023</h1><blockquote>
<p>笔者以星盟安全团队成员的身份参与了本次比赛，在队内师傅们的共同努力下队伍取得了不错的成绩</p>
</blockquote>
<p>队伍排名：4</p>
<p>文章仅就密码方向进行分享。</p>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><p>完成度：12/13</p>
<p>一血数：6</p>
<h3 id="baby-RSA"><a href="#baby-RSA" class="headerlink" title="baby_RSA"></a>baby_RSA</h3><h4 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">nbit = <span class="number">512</span></span><br><span class="line">flag=<span class="string">&#x27;****************************&#x27;</span></span><br><span class="line"></span><br><span class="line">p=getPrime(nbit)</span><br><span class="line">q=getPrime(nbit)</span><br><span class="line">e=<span class="number">65537</span></span><br><span class="line">n=p*q</span><br><span class="line">m= bytes_to_long(<span class="built_in">bytes</span>(flag.encode()))</span><br><span class="line">P = <span class="built_in">pow</span>(m,p,n)</span><br><span class="line">Q = <span class="built_in">pow</span>(m,q,n)</span><br><span class="line">N=P*Q</span><br><span class="line">phi_N=(P-<span class="number">1</span>)*(Q-<span class="number">1</span>)</span><br><span class="line">d=inverse(e,phi_N)</span><br><span class="line">dP=d%(P-<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;n = &#x27;</span>,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;N = &#x27;</span>,N)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;dP = &#x27;</span>,dP)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n =  <span class="number">114101396033690088275999670914803472451228154227614098210572767821433470213124900655723605426526569384342101959232900145334500170690603208327913698128445002527020347955300595384752458477749198178791196660625870659540794807018881780680683388008090434114437818447523471527878292741702348454486217652394664664641</span></span><br><span class="line">N =  <span class="number">1159977299277711167607914893426674454199208605107323826176606074354449015203832606569051328721360397610665453513201486235549374869954501563523028914285006850687275382822302821825953121223999268058107278346499657597050468069712686559045712946025472616754027552629008516489090871415609098178522863027127254404804829735621706042266140637592206366042515190385496909533329383212542170504864473944657824502882014292528444918055958758310544435120502872883857209880723535754528096143707324179005292445100655695427777453144657819474805882956064292780031599790769618615908501966912635232746588639924772530057835864082951499028</span></span><br><span class="line">dP =  <span class="number">33967356791272818610254738927769774016289590226681637441101504040121743937150259930712897925893431093938385216227201268238374281750681609796883676743311872905933219290266120756315613501614208779063819499785817502677885240656957036398336462000771885589364702443157120609506628895933862241269347200444629283263</span></span><br></pre></td></tr></table></figure>

<h4 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h4><ol>
<li><p>dp泄漏分解P、Q</p>
</li>
<li><p>coppersmith解m</p>
<p>$P = m^p \mod n = m \mod p = m+k_1p$</p>
<p>$Q = m^q \mod n = m \mod q = m+k_2q$</p>
<p>$P \cdot Q=m^2+m(k_1p+k_2q)+k_1k_2n=m^2+m(P-m+Q-m) \mod n$</p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2 <span class="keyword">as</span> gp</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">N =  <span class="number">1159977299277711167607914893426674454199208605107323826176606074354449015203832606569051328721360397610665453513201486235549374869954501563523028914285006850687275382822302821825953121223999268058107278346499657597050468069712686559045712946025472616754027552629008516489090871415609098178522863027127254404804829735621706042266140637592206366042515190385496909533329383212542170504864473944657824502882014292528444918055958758310544435120502872883857209880723535754528096143707324179005292445100655695427777453144657819474805882956064292780031599790769618615908501966912635232746588639924772530057835864082951499028</span></span><br><span class="line">dp =  <span class="number">33967356791272818610254738927769774016289590226681637441101504040121743937150259930712897925893431093938385216227201268238374281750681609796883676743311872905933219290266120756315613501614208779063819499785817502677885240656957036398336462000771885589364702443157120609506628895933862241269347200444629283263</span></span><br><span class="line">n =  <span class="number">114101396033690088275999670914803472451228154227614098210572767821433470213124900655723605426526569384342101959232900145334500170690603208327913698128445002527020347955300595384752458477749198178791196660625870659540794807018881780680683388008090434114437818447523471527878292741702348454486217652394664664641</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, e+<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">if</span> (dp*e-<span class="number">1</span>) % a == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> N % ((dp*e-<span class="number">1</span>) // a + <span class="number">1</span>) == <span class="number">0</span>:  <span class="comment"># ! 关键，易漏.要求n被p整除</span></span><br><span class="line">            P = (dp*e-<span class="number">1</span>) // a + <span class="number">1</span></span><br><span class="line">            Q = N // P</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;P =&#x27;</span>, P)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Q =&#x27;</span>, Q)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        a += <span class="number">1</span></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">PR.&lt;m&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = P*Q-m^<span class="number">2</span>-m*(P-m+Q-m)</span><br><span class="line">f = f.monic()</span><br><span class="line">m = f.small_roots(X=<span class="number">2</span>^<span class="number">400</span>, beta=<span class="number">0.4</span>)</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line">flag1 = long_to_bytes(<span class="built_in">int</span>(m[<span class="number">0</span>]))</span><br><span class="line"><span class="built_in">print</span>(flag1)  </span><br><span class="line"><span class="comment"># NKCTF&#123;Th1S_a_babyRSA_y0u_are_tql!!!&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="ez-math"><a href="#ez-math" class="headerlink" title="ez_math"></a>ez_math</h3><h4 id="题目-1"><a href="#题目-1" class="headerlink" title="题目"></a>题目</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, bytes_to_long</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> BITS, hints, flag</span><br><span class="line"></span><br><span class="line">p = getPrime(BITS)</span><br><span class="line">q = getPrime(BITS)</span><br><span class="line">n = p * q</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n = <span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">c = <span class="built_in">pow</span>(bytes_to_long(flag), e, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c = <span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Give you some boring pows:&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(hints)):</span><br><span class="line">    <span class="built_in">print</span>(hints[i])</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">n = 369520637995317866367336688225182965061898803879373674073832046072914710171302486913303917853881549637806426191970292829598855375370563396182543413674021955181862907847280705741114636854238746612618069619482248639049407507041667720977392421249242597197448360531895206645794505182208390084734779667749657408715621</span></span><br><span class="line"><span class="string">c = 324131338592233305486487416176106472248153652884280898177125443926549710357763331715045582842045967830200123100144721322509500306940560917086108978796500145618443920020112366546853892387011738997522207752873944151628204886591075864677988865335625452099668804529484866900390927644093597772065285222172136374562043</span></span><br><span class="line"><span class="string">Give you some boring pows:</span></span><br><span class="line"><span class="string">pow(6, 42762902032363446334121451790132830028099011269558028556333775251728898854654431095595000922138958455510196735338223430882428451914478079186797153527810555787441234842366353864053114538165236037883914332840687123514412294276743506313011532002136735343280737244020115917460801848337792582496228600926958548903290, n) = 4</span></span><br><span class="line"><span class="string">pow(6, 141997416965295486849546892322458652502850390670128808480582247784728456230996812361056958004801816363393016360646922983916999235770803618904474553309200419301820603229504955218189709387942156848904968053547462302189568831762401075340100029630332409419313772378068180267756675141584884876543484516408660699471038, n) = 9</span></span><br><span class="line"><span class="string">pow(6, 163378867981477210016607618217525067516899896304907822758749135410592905658324027908854458465871295591148114728316034699358213461728042658497873130073105697195541220650688132150216266657024774867846925219967805863946774978900772828496605795631400777090954141000078238226487076065753781167791598816872139973922682, n) = 3</span></span><br><span class="line"><span class="string">pow(5, 101651508435846472131121026992982127175369332865677196032272241712711171024515826370577416844824734811581351106736224929238579734879671732717639124571916168742336862493284572465162318403582113621582374924091725060981390318743531229548188092491836655143124663368239422819562367919547196053790207486164506763679128, n) = 4</span></span><br><span class="line"><span class="string">pow(8, 7202269322818255506843028035725052687541091567764933235328308385449791332345247877549905289072216053144576876979686287212194040101112899704499548530779540409356827298148385589812450437990490353926475147376495772639210184768544932563432306664067058309318707174880146258394471096033723193568453520897758319446472, n) = 3</span></span><br><span class="line"><span class="string">pow(6, 64144353048545169501182177685199245042148516904337042834500662877593348281981646643392501383208437683265295103007335146323642677871717118780195730291715833681161852263549530796079671807247854056825871499261030685271618441415115259469517298003205103014921105866030173876191202772506688873744342901390437823354935, n) = 8</span></span><br><span class="line"><span class="string">pow(6, 21381451016181723167060725895066415014049505634779014278166887625864449427327215547797500461069479227755098367669111715441214225957239039593398576763905277893720617421183176932026557269082618018941957166420343561757206147138371753156505766001068367671640368622010057958730400924168896291248114300463479274451645, n) = 2</span></span><br><span class="line"><span class="string">pow(4, 21606807968454766520529084107175158062623274703294799705984925156349373997035743632649715867216648159433730630939058861636582120303338699113498645592338621228070481894445156769437351313971471061779425442129487317917630554305634797690296919992201174927956121524640438775183413288101169580705360562693274958339416, n) = 9</span></span><br><span class="line"><span class="string">pow(2, 21606807968454766520529084107175158062623274703294799705984925156349373997035743632649715867216648159433730630939058861636582120303338699113498645592338621228070481894445156769437351313971471061779425442129487317917630554305634797690296919992201174927956121524640438775183413288101169580705360562693274958339417, n) = 6</span></span><br><span class="line"><span class="string">pow(4, 10803403984227383260264542053587579031311637351647399852992462578174686998517871816324857933608324079716865315469529430818291060151669349556749322796169310614035240947222578384718675656985735530889712721064743658958815277152817398845148459996100587463978060762320219387591706644050584790352680281346637479169708, n) = 3</span></span><br><span class="line"><span class="string">pow(9, 3293982057350410278459882519024200329089724149803879577174733206141551016681048848343176690789446255513117465644006032807116613436995145441651711865811812905401261777042165657533800465011922458688696664211216129846590488003282750224539553623014598025837108471148806368738631086225250952573439068109703953523338, n) = 4</span></span><br><span class="line"><span class="string">pow(2, 43213615936909533041058168214350316125246549406589599411969850312698747994071487265299431734433296318867461261878117723273164240606677398226997291184677242456140963788890313538874702627942942123558850884258974635835261108611269595380593839984402349855912243049280877550366826576202339161410721125386549916678832, n) = 9</span></span><br><span class="line"><span class="string">pow(7, 156359509651684605051402965560382969488421316701585527115005130492947292379802933549188085059602557600903593831240316597311439285149968787780538126741092612405335349622445040578126369183536683733294143156965518222696624206221060030916594302284630706642066420353822195108928341123726471513256217857861184609387726, n) = 9</span></span><br><span class="line"><span class="string">pow(7, 170559914324671769117535654836487226009685359320636182075960576764702323732727088502920021993271666209903403463612731506055433486417625242935904916789051793747298593847158174830184596554822038310041512771676833824200302666130102306284852931958549925702330464987955245647072909056824574486147965487598401928881026, n) = 3</span></span><br><span class="line"><span class="string">pow(8, 123173545998439288789112229408394321687299601293124558024610682024304903390434162304434639284627183212602142063990097609866285125123521132060847804558007316726174558714580872721495215950738261924525921590925432950469320750692763054435407707754979429841729673081392197456811651326615118306026475411557079498916218, n) = 4</span></span><br><span class="line"><span class="string">pow(2, 21606807968454766520529084107175158062623274703294799705984925156349373997035743632649715867216648159433730630939058861636582120303338699113498645592338621228070481894445156769437351313971471061779425442129487317917630554305634797690296919992201174927956121524640438775183413288101169580705360562693274958339416, n) = 3</span></span><br><span class="line"><span class="string">pow(3, 6587964114700820556919765038048400658179448299607759154349466412283102033362097696686353381578892511026234931288012065614233226873990290883303423731623625810802523554084331315067600930023844917377393328422432259693180976006565500449079107246029196051674216942297612737477262172450501905146878136219407907046676, n) = 4</span></span><br><span class="line"><span class="string">pow(7, 146900004342901005519726059203387905743111231159623333298786259340649199259667124880775175860427705602975071010583553281005991812801779033020769274211420710213704563866848310994325033574484679477677016014418321661821714582236428708141287327064859146436371562752616380650770729341741997594308364878898526065859626, n) = 4</span></span><br><span class="line"><span class="string">pow(5, 172192380036714150788905270808196199818277334366508682218739812159577144024191963252552116624193235000074634457087111471641800814071769221933018962135503876997163938949365614056098717522475180216291316295788774044033481065993544994610614082708563841846852650913646728169671510827052772868386414581035580266356334, n) = 3</span></span><br><span class="line"><span class="string">pow(8, 68789042322037899901399142739922213531190892214327212247633649397602243027562329029767224931385807659445647908974735092145336602662873465734923450809783198772444106655438821950560058413359621316189435942839212247873870560114926459781136160541556773230183543715576244986800296759341282346581691226676298068904581, n) = 6</span></span><br><span class="line"><span class="string">pow(5, 159624441075769368394142197503800917105605266793330527400563601282696932962732683048452274321445695181246055818189076528484173940458256745774766217433996778905066039826859919029954611118842967545793750205189398662362981005947945407568116603784658538931110792205205160154125544664182868277733116044735541284338342, n) = 9</span></span><br><span class="line"><span class="string">pow(8, 14404538645636511013686056071450105375082183135529866470656616770899582664690495755099810578144432106289153753959372574424388080202225799408999097061559080818713654596296771179624900875980980707852950294752991545278420369537089865126864613328134116618637414349760292516788942192067446387136907041795516638892944, n) = 9</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h4><ul>
<li><p>找到合适数据求出Kphi</p>
<p>$6^{2B}≡6^A \mod n, 2B!=A$，则$2B ≡ A \mod phi, 2B-A=kphi $</p>
</li>
<li><p>Kphi当phi解出明文m</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">n = <span class="number">369520637995317866367336688225182965061898803879373674073832046072914710171302486913303917853881549637806426191970292829598855375370563396182543413674021955181862907847280705741114636854238746612618069619482248639049407507041667720977392421249242597197448360531895206645794505182208390084734779667749657408715621</span></span><br><span class="line">c = <span class="number">324131338592233305486487416176106472248153652884280898177125443926549710357763331715045582842045967830200123100144721322509500306940560917086108978796500145618443920020112366546853892387011738997522207752873944151628204886591075864677988865335625452099668804529484866900390927644093597772065285222172136374562043</span></span><br><span class="line"></span><br><span class="line">A = <span class="number">141997416965295486849546892322458652502850390670128808480582247784728456230996812361056958004801816363393016360646922983916999235770803618904474553309200419301820603229504955218189709387942156848904968053547462302189568831762401075340100029630332409419313772378068180267756675141584884876543484516408660699471038</span></span><br><span class="line">B = <span class="number">163378867981477210016607618217525067516899896304907822758749135410592905658324027908854458465871295591148114728316034699358213461728042658497873130073105697195541220650688132150216266657024774867846925219967805863946774978900772828496605795631400777090954141000078238226487076065753781167791598816872139973922682</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">pow</span>(<span class="number">6</span>, <span class="number">2</span>*B, n) == <span class="built_in">pow</span>(<span class="number">6</span>, A, n)</span><br><span class="line"><span class="keyword">assert</span> <span class="number">2</span>*B != A</span><br><span class="line"></span><br><span class="line">Kphi = <span class="number">2</span>*B-A</span><br><span class="line">d = gmpy2.invert(e, Kphi)</span><br><span class="line">m = <span class="built_in">int</span>(<span class="built_in">pow</span>(c,d,n))</span><br><span class="line"><span class="built_in">print</span>(libnum.n2s(m))</span><br><span class="line"><span class="comment"># NKCTF&#123;d15cr373_L0g_15_R3DuC710n_f0R_f4C70r1nG&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="ezRSA"><a href="#ezRSA" class="headerlink" title="ezRSA"></a>ezRSA</h3><h4 id="题目-2"><a href="#题目-2" class="headerlink" title="题目"></a>题目</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">m1 = bytes_to_long(flag[:<span class="built_in">len</span>(flag)//<span class="number">3</span>])</span><br><span class="line">m2 = bytes_to_long(flag[<span class="built_in">len</span>(flag)//<span class="number">3</span>:])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen</span>():</span></span><br><span class="line">    prime_list  = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        prime_list.append(getPrime(<span class="number">512</span>))</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sorted</span>(prime_list)</span><br><span class="line"></span><br><span class="line">prime_list = gen()</span><br><span class="line">p,q,r,t = prime_list[<span class="number">0</span>],prime_list[<span class="number">3</span>],prime_list[<span class="number">1</span>],prime_list[<span class="number">2</span>]</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n = p*q*r*t</span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)*(r-<span class="number">1</span>)*(t-<span class="number">1</span>)</span><br><span class="line">c1 = <span class="built_in">pow</span>(m1,e,p*q)</span><br><span class="line">p1 = getPrime(<span class="number">512</span>)</span><br><span class="line">q1 = getPrime(<span class="number">512</span>)</span><br><span class="line">N = p1*q1</span><br><span class="line">c2 = <span class="built_in">pow</span>(m2,p1,N)</span><br><span class="line">c3 = <span class="built_in">pow</span>(m2,q1,N)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n = <span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;phi = <span class="subst">&#123;phi&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c1 = <span class="subst">&#123;c1&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;N = <span class="subst">&#123;N&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c2 = <span class="subst">&#123;c2&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c3 = <span class="subst">&#123;c3&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 8836130216343708623415307573630337110573363595188748983290313549413242332143945452914800845282478216810685733227137911630239808895196748125078747600505626165666334675100147790578546682128517668100858766784733351894480181877144793496927464058323582165412552970999921215333509253052644024478417393146000490808639363681195799826541558906527985336104761974023394438549055804234997654701266967731137282297623426318212701157416397999108259257077847307874122736921265599854976855949680133804464839768470200425669609996841568545945133611190979810786943246285103031363790663362165522662820344917056587244701635831061853354597</span></span><br><span class="line"><span class="string">phi = 8836130216343708623415307573630337110573363595188748983290313549413242332143945452914800845282478216810685733227137911630239808895196748125078747600505622503351461565956106005118029537938273153581675065762015952483687057805462728186901563990429998916382820576211887477098611684072561849314986341226981300596338314989867731725668312057134075244816223120038573374383949718714549930261073576391501671722900294331289082826058292599838631513746370889828026039555245672195833927609280773258978856664434349221972568651378808050580665443131001632395175205804045958846124475183825589672204752895252723130454951830966138888560</span></span><br><span class="line"><span class="string">c1 = 78327207863361017953496121356221173288422862370301396867341957979087627011991738176024643637029313969241151622985226595093079857523487726626882109114134910056673489916408854152274726721451884257677533593174371742411008169082367666168983943358876017521749198218529804830864940274185360506199116451280975188409</span></span><br><span class="line"><span class="string">N = 157202814866563156513184271957553223260772141845129283711146204376449001653397810781717934720804041916333174673656579086498762693983380365527400604554663873045166444369504886603233275868192688995284322277504050322927511160583280269073338415758019142878016084536129741435221345599028001581385308324407324725353</span></span><br><span class="line"><span class="string">c2 = 63355788175487221030596314921407476078592001060627033831694843409637965350474955727383434406640075122932939559532216639739294413008164038257338675094324172634789610307227365830016457714456293397466445820352804725466971828172010276387616894829328491068298742711984800900411277550023220538443014162710037992032</span></span><br><span class="line"><span class="string">c3 = 9266334096866207047544089419994475379619964393206968260875878305040712629590906330073542575719856965053269812924808810766674072615270535207284077081944428011398767330973702305174973148018082513467080087706443512285098600431136743009829009567065760786940706627087366702015319792328141978938111501345426931078</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="题解-2"><a href="#题解-2" class="headerlink" title="题解"></a>题解</h4><ol>
<li>已知phi分解n,常规rsa求解flag1</li>
<li>通过m1确定m2比特位，最后用baby_RSA的coppersmith解法再解一次m2</li>
</ol>
<p>已知phi分解n</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> gcd</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> isqrt</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randrange</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> is_prime</span><br><span class="line"><span class="comment"># from sage.all import is_prime</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">factorize</span>(<span class="params">N, phi</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Recovers the prime factors from a modulus if Euler&#x27;s totient is known.</span></span><br><span class="line"><span class="string">    This method only works for a modulus consisting of 2 primes!</span></span><br><span class="line"><span class="string">    :param N: the modulus</span></span><br><span class="line"><span class="string">    :param phi: Euler&#x27;s totient, the order of the multiplicative group modulo N</span></span><br><span class="line"><span class="string">    :return: a tuple containing the prime factors, or None if the factors were not found</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    s = N + <span class="number">1</span> - phi</span><br><span class="line">    d = s ** <span class="number">2</span> - <span class="number">4</span> * N</span><br><span class="line">    p = <span class="built_in">int</span>(s - isqrt(d)) // <span class="number">2</span></span><br><span class="line">    q = <span class="built_in">int</span>(s + isqrt(d)) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> p, q</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">factorize_multi_prime</span>(<span class="params">N, phi</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Recovers the prime factors from a modulus if Euler&#x27;s totient is known.</span></span><br><span class="line"><span class="string">    This method works for a modulus consisting of any number of primes, but is considerably be slower than factorize.</span></span><br><span class="line"><span class="string">    More information: Hinek M. J., Low M. K., Teske E., &quot;On Some Attacks on Multi-prime RSA&quot; (Section 3)</span></span><br><span class="line"><span class="string">    :param N: the modulus</span></span><br><span class="line"><span class="string">    :param phi: Euler&#x27;s totient, the order of the multiplicative group modulo N</span></span><br><span class="line"><span class="string">    :return: a tuple containing the prime factors</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    prime_factors = <span class="built_in">set</span>()</span><br><span class="line">    factors = [N]</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(factors) &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="comment"># Element to factorize.</span></span><br><span class="line">        N = factors[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        w = randrange(<span class="number">2</span>, N - <span class="number">1</span>)</span><br><span class="line">        i = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> phi % (<span class="number">2</span> ** i) == <span class="number">0</span>:</span><br><span class="line">            sqrt_1 = <span class="built_in">pow</span>(w, phi // (<span class="number">2</span> ** i), N)</span><br><span class="line">            <span class="keyword">if</span> sqrt_1 &gt; <span class="number">1</span> <span class="keyword">and</span> sqrt_1 != N - <span class="number">1</span>:</span><br><span class="line">                <span class="comment"># We can remove the element to factorize now, because we have a factorization.</span></span><br><span class="line">                factors = factors[<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line">                p = gcd(N, sqrt_1 + <span class="number">1</span>)</span><br><span class="line">                q = N // p</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> is_prime(p):</span><br><span class="line">                    prime_factors.add(p)</span><br><span class="line">                <span class="keyword">elif</span> p &gt; <span class="number">1</span>:</span><br><span class="line">                    factors.append(p)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> is_prime(q):</span><br><span class="line">                    prime_factors.add(q)</span><br><span class="line">                <span class="keyword">elif</span> q &gt; <span class="number">1</span>:</span><br><span class="line">                    factors.append(q)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Continue in the outer loop</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">tuple</span>(prime_factors)</span><br><span class="line"><span class="keyword">if</span> __name__ ==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    n = <span class="number">8836130216343708623415307573630337110573363595188748983290313549413242332143945452914800845282478216810685733227137911630239808895196748125078747600505626165666334675100147790578546682128517668100858766784733351894480181877144793496927464058323582165412552970999921215333509253052644024478417393146000490808639363681195799826541558906527985336104761974023394438549055804234997654701266967731137282297623426318212701157416397999108259257077847307874122736921265599854976855949680133804464839768470200425669609996841568545945133611190979810786943246285103031363790663362165522662820344917056587244701635831061853354597</span></span><br><span class="line">    phi = <span class="number">8836130216343708623415307573630337110573363595188748983290313549413242332143945452914800845282478216810685733227137911630239808895196748125078747600505622503351461565956106005118029537938273153581675065762015952483687057805462728186901563990429998916382820576211887477098611684072561849314986341226981300596338314989867731725668312057134075244816223120038573374383949718714549930261073576391501671722900294331289082826058292599838631513746370889828026039555245672195833927609280773258978856664434349221972568651378808050580665443131001632395175205804045958846124475183825589672204752895252723130454951830966138888560</span></span><br><span class="line">    fac = factorize_multi_prime(n, phi)</span><br><span class="line">    <span class="built_in">print</span>(fac)</span><br></pre></td></tr></table></figure>

<p>coppersmith解法再解一次m2</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n = <span class="number">8836130216343708623415307573630337110573363595188748983290313549413242332143945452914800845282478216810685733227137911630239808895196748125078747600505626165666334675100147790578546682128517668100858766784733351894480181877144793496927464058323582165412552970999921215333509253052644024478417393146000490808639363681195799826541558906527985336104761974023394438549055804234997654701266967731137282297623426318212701157416397999108259257077847307874122736921265599854976855949680133804464839768470200425669609996841568545945133611190979810786943246285103031363790663362165522662820344917056587244701635831061853354597</span></span><br><span class="line">phi = <span class="number">8836130216343708623415307573630337110573363595188748983290313549413242332143945452914800845282478216810685733227137911630239808895196748125078747600505622503351461565956106005118029537938273153581675065762015952483687057805462728186901563990429998916382820576211887477098611684072561849314986341226981300596338314989867731725668312057134075244816223120038573374383949718714549930261073576391501671722900294331289082826058292599838631513746370889828026039555245672195833927609280773258978856664434349221972568651378808050580665443131001632395175205804045958846124475183825589672204752895252723130454951830966138888560</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c1 = <span class="number">78327207863361017953496121356221173288422862370301396867341957979087627011991738176024643637029313969241151622985226595093079857523487726626882109114134910056673489916408854152274726721451884257677533593174371742411008169082367666168983943358876017521749198218529804830864940274185360506199116451280975188409</span></span><br><span class="line"></span><br><span class="line">prime_list = [<span class="number">10278918289612367146046409135513725291319742611325451529622387426552790672650542777172769017399682768083823848127693717878822223823002122605741847534168871</span>, <span class="number">8420341711111386139826589531912136886697864041156239432418101990860951057225344962981814097328105109563572968937589482777359728076364540186966659710593563</span>, <span class="number">9422949623669587592195284918343137628924288670457557164230168847803264549856927866278221296107887154859174132983372562130946621134855520373823156469022523</span>, <span class="number">10834231423967940002221004300639472879422266804796466209639481015717927053785699849888626682293072249949761634253205413288361321778947376683555990557548843</span>]</span><br><span class="line">prime_list = <span class="built_in">sorted</span>(prime_list)</span><br><span class="line">p,q,r,t = prime_list[<span class="number">0</span>],prime_list[<span class="number">3</span>],prime_list[<span class="number">1</span>],prime_list[<span class="number">2</span>]</span><br><span class="line">d1 = gmpy2.invert(e, phi)</span><br><span class="line">m1 = <span class="built_in">int</span>(<span class="built_in">pow</span>(c1, d1, p*q))</span><br><span class="line">flag1 = libnum.n2s(m1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># part 2</span></span><br><span class="line">N = <span class="number">157202814866563156513184271957553223260772141845129283711146204376449001653397810781717934720804041916333174673656579086498762693983380365527400604554663873045166444369504886603233275868192688995284322277504050322927511160583280269073338415758019142878016084536129741435221345599028001581385308324407324725353</span></span><br><span class="line">c2 = <span class="number">63355788175487221030596314921407476078592001060627033831694843409637965350474955727383434406640075122932939559532216639739294413008164038257338675094324172634789610307227365830016457714456293397466445820352804725466971828172010276387616894829328491068298742711984800900411277550023220538443014162710037992032</span></span><br><span class="line">c3 = <span class="number">9266334096866207047544089419994475379619964393206968260875878305040712629590906330073542575719856965053269812924808810766674072615270535207284077081944428011398767330973702305174973148018082513467080087706443512285098600431136743009829009567065760786940706627087366702015319792328141978938111501345426931078</span></span><br><span class="line">n = N</span><br><span class="line">P = c2</span><br><span class="line">Q = c3</span><br><span class="line">        </span><br><span class="line">PR.&lt;m&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = P*Q-m^<span class="number">2</span>-m*(P-m+Q-m)</span><br><span class="line">f = f.monic()</span><br><span class="line">m = f.small_roots(X=<span class="number">2</span>^(<span class="built_in">len</span>(flag1)*<span class="number">2</span>*<span class="number">8</span>), beta=<span class="number">0.7</span>)</span><br><span class="line"></span><br><span class="line">flag2 = libnum.n2s(<span class="built_in">int</span>(m[<span class="number">0</span>]))</span><br><span class="line"><span class="built_in">print</span>(flag1+flag2)</span><br><span class="line"><span class="comment"># b&#x27;NKCTF&#123;it_i5_e45y_th4t_Kn0wn_phi_4nd_N_dec0mp0ses_N_w1th_th3_s4m3_c0mm0n_n_but_pq&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="real-MT"><a href="#real-MT" class="headerlink" title="real_MT"></a>real_MT</h3><h4 id="题目-3"><a href="#题目-3" class="headerlink" title="题目"></a>题目</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> signal</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">guess_number_1</span>():</span></span><br><span class="line">    randoms = []</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">208</span>):</span><br><span class="line">        randoms.append(random.getrandbits(<span class="number">96</span>))</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;randoms = &quot;</span>+<span class="built_in">str</span>(randoms))</span><br><span class="line">    number = <span class="built_in">str</span>(random.getrandbits(<span class="number">96</span>))</span><br><span class="line">    guess = <span class="built_in">str</span>(<span class="built_in">input</span>(<span class="string">&quot;Guess after number:&quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> guess != number:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Wrong Number! Guess again.&quot;</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">guess_number_2</span>():</span></span><br><span class="line">    number = <span class="built_in">str</span>(random.getrandbits(<span class="number">96</span>))</span><br><span class="line">    randoms = []</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">627</span>):</span><br><span class="line">        randoms.append(random.getrandbits(<span class="number">32</span>))</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;randoms = &quot;</span>+<span class="built_in">str</span>(randoms))</span><br><span class="line">    guess = <span class="built_in">str</span>(<span class="built_in">input</span>(<span class="string">&quot;Guess pre number:&quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> guess != number:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Wrong Number! Guess again.&quot;</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">guess_number_3</span>():</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_int32</span>(<span class="params">x</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(<span class="number">0xFFFFFFFF</span> &amp; x)  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init</span>(<span class="params">seed</span>):</span></span><br><span class="line">        mt = [<span class="number">0</span>] * <span class="number">624</span></span><br><span class="line">        mt[<span class="number">0</span>] = seed</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">624</span>):</span><br><span class="line">            mt[i] = _int32(<span class="number">1812433253</span> * (mt[i - <span class="number">1</span>] ^ mt[i - <span class="number">1</span>] &gt;&gt; <span class="number">30</span>) + i)</span><br><span class="line">        <span class="keyword">return</span> mt[-<span class="number">1</span>]</span><br><span class="line">    number = random.getrandbits(<span class="number">32</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;last number = &quot;</span>+ <span class="built_in">str</span>(init(number)))</span><br><span class="line">    guess = <span class="built_in">int</span>(<span class="built_in">str</span>(<span class="built_in">input</span>(<span class="string">&quot;Guess seed number:&quot;</span>)))</span><br><span class="line">    <span class="keyword">if</span> guess != number:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Wrong Number! Guess again.&quot;</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">guess_number_4</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">extract_number</span>(<span class="params">y</span>):</span></span><br><span class="line">        y = y ^ y &gt;&gt; <span class="number">11</span></span><br><span class="line">        y = y ^ y &lt;&lt; <span class="number">7</span> &amp; <span class="number">2636928640</span></span><br><span class="line">        y = y ^ y &lt;&lt; <span class="number">15</span> &amp; <span class="number">4022730752</span></span><br><span class="line">        y = y ^ y &gt;&gt; <span class="number">18</span></span><br><span class="line">        <span class="keyword">return</span> y&amp;<span class="number">0xffffffff</span></span><br><span class="line"></span><br><span class="line">    number = random.getrandbits(<span class="number">32</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;extract number = &quot;</span>+ <span class="built_in">str</span>(extract_number(number)))</span><br><span class="line">    guess = <span class="built_in">int</span>(<span class="built_in">str</span>(<span class="built_in">input</span>(<span class="string">&quot;Guess be extracted number:&quot;</span>)))</span><br><span class="line">    <span class="keyword">if</span> guess != number:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Wrong Number! Guess again.&quot;</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Welcome to the Mersenne Twister basic challenge. Please try to solve 20 challenges in 60 seconds.&quot;</span>)</span><br><span class="line">signal.alarm(<span class="number">60</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Round: &quot;</span>+<span class="built_in">str</span>(i+<span class="number">1</span>))</span><br><span class="line">    random.choice([guess_number_1,guess_number_2,guess_number_3,guess_number_4])()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Good job!&quot;</span>)</span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">open</span>(<span class="string">&#x27;/flag&#x27;</span>).read()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Congratulations on passing the challenge. This is your flag: &quot;</span> + <span class="built_in">str</span>(flag))</span><br></pre></td></tr></table></figure>

<h4 id="题解-3"><a href="#题解-3" class="headerlink" title="题解"></a>题解</h4><p>MT19937相关的经典内容大杂烩，参考<a target="_blank" rel="noopener" href="https://badmonkey.site/archives/mt19937">badmonkey师傅博客</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> extend_mt19937_predictor <span class="keyword">import</span> ExtendMT19937Predictor</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># right shift inverse</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inverse_right</span>(<span class="params">res, shift, bits=<span class="number">32</span></span>):</span></span><br><span class="line">    tmp = res</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(bits // shift):</span><br><span class="line">        tmp = res ^ tmp &gt;&gt; shift</span><br><span class="line">    <span class="keyword">return</span> tmp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># left shift with mask inverse</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inverse_left_mask</span>(<span class="params">res, shift, mask, bits=<span class="number">32</span></span>):</span></span><br><span class="line">    tmp = res</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(bits // shift):</span><br><span class="line">        tmp = res ^ tmp &lt;&lt; shift &amp; mask</span><br><span class="line">    <span class="keyword">return</span> tmp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">recover</span>(<span class="params">y</span>):</span></span><br><span class="line">    y = inverse_right(y, <span class="number">18</span>)</span><br><span class="line">    y = inverse_left_mask(y, <span class="number">15</span>, <span class="number">4022730752</span>)</span><br><span class="line">    y = inverse_left_mask(y, <span class="number">7</span>, <span class="number">2636928640</span>)</span><br><span class="line">    y = inverse_right(y, <span class="number">11</span>)</span><br><span class="line">    <span class="keyword">return</span> y &amp; <span class="number">0xffffffff</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">attack1</span>(<span class="params">list1</span>):</span></span><br><span class="line">    predictor = ExtendMT19937Predictor()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">208</span>):</span><br><span class="line">        predictor.setrandbits(list1[i], <span class="number">96</span>)</span><br><span class="line">    <span class="keyword">return</span> predictor.predict_getrandbits(<span class="number">96</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">attack2</span>(<span class="params">list1</span>):</span></span><br><span class="line">    predictor = ExtendMT19937Predictor()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">627</span>):</span><br><span class="line">        predictor.setrandbits(list1[i], <span class="number">32</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">627</span>):</span><br><span class="line">        predictor.backtrack_getrandbits(<span class="number">32</span>)</span><br><span class="line">    x = predictor.backtrack_getrandbits(<span class="number">96</span>)</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">attack3</span>(<span class="params">last</span>):</span></span><br><span class="line">    n = <span class="number">1</span> &lt;&lt; <span class="number">32</span></span><br><span class="line">    inv = gmpy2.invert(<span class="number">1812433253</span>, n)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">623</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">        last = ((last - i) * inv) % n</span><br><span class="line">        last = inverse_right(last, <span class="number">30</span>)</span><br><span class="line">    <span class="keyword">return</span> last</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">attack4</span>(<span class="params">y</span>):</span></span><br><span class="line">    <span class="keyword">return</span> recover(y)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># :</span></span><br><span class="line">sh = remote(<span class="string">&#x27;node.yuzhian.com.cn&#x27;</span>, <span class="number">38574</span>)</span><br><span class="line">sh.recvuntil(<span class="string">b&#x27;Press Enter to start...&#x27;</span>)</span><br><span class="line">sh.sendline()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">    sh.recvline_contains(<span class="string">b&#x27;Round:&#x27;</span>)</span><br><span class="line">    data = sh.recvuntil(<span class="string">b&#x27;:&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;Guess after number:&#x27;</span> <span class="keyword">in</span> data:</span><br><span class="line">        data.replace(<span class="string">b&#x27;Guess after number:&#x27;</span>, <span class="string">b&#x27;&#x27;</span>)</span><br><span class="line">        data = <span class="built_in">eval</span>(data.split(<span class="string">b&#x27;randoms = &#x27;</span>)[-<span class="number">1</span>].split(<span class="string">b&#x27;\n&#x27;</span>)[<span class="number">0</span>])</span><br><span class="line">        ans = attack1(data)</span><br><span class="line">    <span class="keyword">elif</span> <span class="string">b&#x27;Guess pre number:&#x27;</span> <span class="keyword">in</span> data:</span><br><span class="line">        data.replace(<span class="string">b&#x27;Guess pre number:&#x27;</span>, <span class="string">b&#x27;&#x27;</span>)</span><br><span class="line">        data = <span class="built_in">eval</span>(data.split(<span class="string">b&#x27;randoms = &#x27;</span>)[-<span class="number">1</span>].split(<span class="string">b&#x27;\n&#x27;</span>)[<span class="number">0</span>])</span><br><span class="line">        ans = attack2(data)</span><br><span class="line">    <span class="keyword">elif</span> <span class="string">b&#x27;Guess seed number:&#x27;</span> <span class="keyword">in</span> data:</span><br><span class="line">        data.replace(<span class="string">b&#x27;Guess seed number:&#x27;</span>, <span class="string">b&#x27;&#x27;</span>)</span><br><span class="line">        data = <span class="built_in">eval</span>(data.split(<span class="string">b&#x27;last number = &#x27;</span>)[-<span class="number">1</span>].split(<span class="string">b&#x27;\n&#x27;</span>)[<span class="number">0</span>])</span><br><span class="line">        ans = attack3(data)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        data.replace(<span class="string">b&#x27;Guess be extracted number:&#x27;</span>, <span class="string">b&#x27;&#x27;</span>)</span><br><span class="line">        data = <span class="built_in">eval</span>(data.split(<span class="string">b&#x27;extract number = &#x27;</span>)[-<span class="number">1</span>].split(<span class="string">b&#x27;\n&#x27;</span>)[<span class="number">0</span>])</span><br><span class="line">        ans = attack4(data)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(ans).encode())</span><br><span class="line">    sh.recvline()  <span class="comment"># Good job!</span></span><br><span class="line">sh.interactive()</span><br><span class="line"><span class="comment"># NKCTF&#123;73e1d7d9-29f5-4a9c-a4a8-0350faf4cb76&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="fake-MT"><a href="#fake-MT" class="headerlink" title="fake_MT"></a>fake_MT</h3><h4 id="题目-4"><a href="#题目-4" class="headerlink" title="题目"></a>题目</h4><p>基本如上，差别是用的py2</p>
<h4 id="题解-4"><a href="#题解-4" class="headerlink" title="题解"></a>题解</h4><p>出题人预期的非预期解是利用py2的input能当eval用。</p>
<p>如下是非预期的预期解：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> extend_mt19937_predictor <span class="keyword">import</span> ExtendMT19937Predictor</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># right shift inverse</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inverse_right</span>(<span class="params">res, shift, bits=<span class="number">32</span></span>):</span></span><br><span class="line">    tmp = res</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(bits // shift):</span><br><span class="line">        tmp = res ^ tmp &gt;&gt; shift</span><br><span class="line">    <span class="keyword">return</span> tmp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># left shift with mask inverse</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inverse_left_mask</span>(<span class="params">res, shift, mask, bits=<span class="number">32</span></span>):</span></span><br><span class="line">    tmp = res</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(bits // shift):</span><br><span class="line">        tmp = res ^ tmp &lt;&lt; shift &amp; mask</span><br><span class="line">    <span class="keyword">return</span> tmp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">recover</span>(<span class="params">y</span>):</span></span><br><span class="line">    y = inverse_right(y, <span class="number">18</span>)</span><br><span class="line">    y = inverse_left_mask(y, <span class="number">15</span>, <span class="number">4022730752</span>)</span><br><span class="line">    y = inverse_left_mask(y, <span class="number">7</span>, <span class="number">2636928640</span>)</span><br><span class="line">    y = inverse_right(y, <span class="number">11</span>)</span><br><span class="line">    <span class="keyword">return</span> y &amp; <span class="number">0xffffffff</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">attack1</span>(<span class="params">list1</span>):</span></span><br><span class="line">    predictor = ExtendMT19937Predictor()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">208</span>):</span><br><span class="line">        predictor.setrandbits(list1[i], <span class="number">96</span>)</span><br><span class="line">    <span class="keyword">return</span> predictor.predict_getrandbits(<span class="number">96</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">attack2</span>(<span class="params">list1</span>):</span></span><br><span class="line">    predictor = ExtendMT19937Predictor()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">627</span>):</span><br><span class="line">        predictor.setrandbits(list1[i], <span class="number">32</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">627</span>):</span><br><span class="line">        predictor.backtrack_getrandbits(<span class="number">32</span>)</span><br><span class="line">    x = predictor.backtrack_getrandbits(<span class="number">96</span>)</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">attack3</span>(<span class="params">last</span>):</span></span><br><span class="line">    n = <span class="number">1</span> &lt;&lt; <span class="number">32</span></span><br><span class="line">    inv = gmpy2.invert(<span class="number">1812433253</span>, n)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">623</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">        last = ((last - i) * inv) % n</span><br><span class="line">        last = inverse_right(last, <span class="number">30</span>)</span><br><span class="line">    <span class="keyword">return</span> last</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">attack4</span>(<span class="params">y</span>):</span></span><br><span class="line">    <span class="keyword">return</span> recover(y)</span><br><span class="line"></span><br><span class="line">sh = remote(<span class="string">&#x27;node.yuzhian.com.cn&#x27;</span>, <span class="number">35467</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">    sh.recvline_contains(<span class="string">b&#x27;Round:&#x27;</span>)</span><br><span class="line">    data = sh.recvuntil(<span class="string">b&#x27;:&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;Guess after number:&#x27;</span> <span class="keyword">in</span> data:</span><br><span class="line">        data = data.replace(<span class="string">b&#x27;L&#x27;</span>, <span class="string">b&#x27;&#x27;</span>)</span><br><span class="line">        data = <span class="built_in">eval</span>(data.split(<span class="string">b&#x27;randoms = &#x27;</span>)[-<span class="number">1</span>].split(<span class="string">b&#x27;\n&#x27;</span>)[<span class="number">0</span>])</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line">        ans = attack1(data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> <span class="string">b&#x27;Guess pre number:&#x27;</span> <span class="keyword">in</span> data:</span><br><span class="line">        data = data.replace(<span class="string">b&#x27;L&#x27;</span>, <span class="string">b&#x27;&#x27;</span>)</span><br><span class="line">        data = <span class="built_in">eval</span>(data.split(<span class="string">b&#x27;randoms = &#x27;</span>)[-<span class="number">1</span>].split(<span class="string">b&#x27;\n&#x27;</span>)[<span class="number">0</span>])</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line">        ans = attack2(data)</span><br><span class="line">    <span class="keyword">elif</span> <span class="string">b&#x27;Guess seed number:&#x27;</span> <span class="keyword">in</span> data:</span><br><span class="line">        data = data.replace(<span class="string">b&#x27;L&#x27;</span>, <span class="string">b&#x27;&#x27;</span>)</span><br><span class="line">        data = <span class="built_in">eval</span>(data.split(<span class="string">b&#x27;last number = &#x27;</span>)[-<span class="number">1</span>].split(<span class="string">b&#x27;\n&#x27;</span>)[<span class="number">0</span>])</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line">        ans = attack3(data)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        data = data.replace(<span class="string">b&#x27;L&#x27;</span>, <span class="string">b&#x27;&#x27;</span>)</span><br><span class="line">        data = <span class="built_in">eval</span>(data.split(<span class="string">b&#x27;extract number = &#x27;</span>)[-<span class="number">1</span>].split(<span class="string">b&#x27;\n&#x27;</span>)[<span class="number">0</span>])</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line">        ans = attack4(data)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(ans).encode())</span><br><span class="line">    sh.recvline()  <span class="comment"># Good job!</span></span><br><span class="line">sh.interactive()</span><br><span class="line"><span class="comment"># NKCTF&#123;55d825f1-8bc1-421d-850f-2af971731b5d&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="ez-polynomial"><a href="#ez-polynomial" class="headerlink" title="ez_polynomial"></a>ez_polynomial</h3><h4 id="题目-5"><a href="#题目-5" class="headerlink" title="题目"></a>题目</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#sage</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">flag = <span class="built_in">list</span>(<span class="built_in">bytearray</span>(<span class="string">&#x27;&#x27;</span>))</span><br><span class="line">p = getPrime(<span class="number">16</span>)</span><br><span class="line">R.&lt;y&gt; = PolynomialRing(GF(p))</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    P1 = R.random_element(degree=(ZZ.random_element(<span class="built_in">len</span>(flag), <span class="number">2</span>*<span class="built_in">len</span>(flag))))</span><br><span class="line">    Q1 = R.random_element(degree=(ZZ.random_element(<span class="built_in">len</span>(flag), <span class="number">2</span>*<span class="built_in">len</span>(flag))))</span><br><span class="line">    <span class="keyword">if</span> P1.is_irreducible() <span class="keyword">and</span> Q1.is_irreducible():</span><br><span class="line">        P = P1</span><br><span class="line">        Q = Q1</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">N = P*Q</span><br><span class="line">S.&lt;x&gt; = R.quotient(N)</span><br><span class="line">c = S(flag) ^ e</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;P:&quot;</span> + <span class="built_in">str</span>(p) + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;N:&quot;</span> + <span class="built_in">str</span>(N) + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;C:&quot;</span> + <span class="built_in">str</span>(c))</span><br><span class="line"></span><br><span class="line"><span class="comment">#P:40031</span></span><br><span class="line"><span class="comment">#N:24096*y^93 + 38785*y^92 + 17489*y^91 + 9067*y^90 + 1034*y^89 + 6534*y^88 + 35818*y^87 + 22046*y^86 + 12887*y^85 + 445*y^84 + 26322*y^83 + 37045*y^82 + 4486*y^81 + 3503*y^80 + 1184*y^79 + 38471*y^78 + 8012*y^77 + 36561*y^76 + 19429*y^75 + 35227*y^74 + 10813*y^73 + 26341*y^72 + 29474*y^71 + 2059*y^70 + 16068*y^69 + 31597*y^68 + 14685*y^67 + 9266*y^66 + 31019*y^65 + 6171*y^64 + 385*y^63 + 28986*y^62 + 9912*y^61 + 10632*y^60 + 33741*y^59 + 12634*y^58 + 21179*y^57 + 35548*y^56 + 17894*y^55 + 7152*y^54 + 9440*y^53 + 4004*y^52 + 2600*y^51 + 12281*y^50 + 22*y^49 + 17314*y^48 + 32694*y^47 + 7693*y^46 + 6567*y^45 + 19897*y^44 + 27329*y^43 + 8799*y^42 + 36348*y^41 + 33963*y^40 + 23730*y^39 + 27685*y^38 + 29037*y^37 + 14622*y^36 + 29608*y^35 + 39588*y^34 + 23294*y^33 + 757*y^32 + 20140*y^31 + 19511*y^30 + 1469*y^29 + 3898*y^28 + 6630*y^27 + 19610*y^26 + 11631*y^25 + 7188*y^24 + 11683*y^23 + 35611*y^22 + 37286*y^21 + 32139*y^20 + 20296*y^19 + 36426*y^18 + 25340*y^17 + 36204*y^16 + 37787*y^15 + 31256*y^14 + 505*y^13 + 27508*y^12 + 20885*y^11 + 32037*y^10 + 31236*y^9 + 7929*y^8 + 27195*y^7 + 28980*y^6 + 11863*y^5 + 16025*y^4 + 16389*y^3 + 570*y^2 + 36547*y + 10451</span></span><br><span class="line"><span class="comment">#C:3552*x^92 + 6082*x^91 + 25295*x^90 + 35988*x^89 + 26052*x^88 + 16987*x^87 + 12854*x^86 + 25117*x^85 + 25800*x^84 + 30297*x^83 + 5589*x^82 + 23233*x^81 + 14449*x^80 + 4712*x^79 + 35719*x^78 + 1696*x^77 + 35653*x^76 + 13995*x^75 + 13715*x^74 + 4578*x^73 + 37366*x^72 + 25260*x^71 + 28865*x^70 + 36120*x^69 + 7047*x^68 + 10497*x^67 + 19160*x^66 + 17939*x^65 + 14850*x^64 + 6705*x^63 + 17805*x^62 + 30083*x^61 + 2400*x^60 + 10685*x^59 + 15272*x^58 + 2225*x^57 + 13194*x^56 + 14251*x^55 + 31016*x^54 + 10189*x^53 + 35040*x^52 + 7042*x^51 + 29206*x^50 + 39363*x^49 + 32608*x^48 + 38614*x^47 + 5528*x^46 + 20119*x^45 + 13439*x^44 + 25468*x^43 + 30056*x^42 + 19720*x^41 + 21808*x^40 + 3712*x^39 + 25243*x^38 + 10606*x^37 + 16247*x^36 + 36106*x^35 + 17287*x^34 + 36276*x^33 + 1407*x^32 + 28839*x^31 + 8459*x^30 + 38863*x^29 + 435*x^28 + 913*x^27 + 36619*x^26 + 15572*x^25 + 9363*x^24 + 36837*x^23 + 17925*x^22 + 38567*x^21 + 38709*x^20 + 13582*x^19 + 35038*x^18 + 31121*x^17 + 8933*x^16 + 1666*x^15 + 21940*x^14 + 25585*x^13 + 840*x^12 + 21938*x^11 + 20143*x^10 + 28507*x^9 + 5947*x^8 + 20289*x^7 + 32196*x^6 + 924*x^5 + 370*x^4 + 14849*x^3 + 10780*x^2 + 14035*x + 15327</span></span><br></pre></td></tr></table></figure>

<h4 id="题解-5"><a href="#题解-5" class="headerlink" title="题解"></a>题解</h4><p>常规的多项式rsa。</p>
<p>没了解过的话，可以去<a target="_blank" rel="noopener" href="https://lazzzaro.github.io/2020/05/06/crypto-RSA/">lazzaro师傅博客</a>里翻一翻</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2, libnum</span><br><span class="line">p = <span class="number">40031</span></span><br><span class="line">S.&lt;x&gt; = PolynomialRing(GF(p))</span><br><span class="line">y = x</span><br><span class="line">N=<span class="number">24096</span>*y^<span class="number">93</span> + <span class="number">38785</span>*y^<span class="number">92</span> + <span class="number">17489</span>*y^<span class="number">91</span> + <span class="number">9067</span>*y^<span class="number">90</span> + <span class="number">1034</span>*y^<span class="number">89</span> + <span class="number">6534</span>*y^<span class="number">88</span> + <span class="number">35818</span>*y^<span class="number">87</span> + <span class="number">22046</span>*y^<span class="number">86</span> + <span class="number">12887</span>*y^<span class="number">85</span> + <span class="number">445</span>*y^<span class="number">84</span> + <span class="number">26322</span>*y^<span class="number">83</span> + <span class="number">37045</span>*y^<span class="number">82</span> + <span class="number">4486</span>*y^<span class="number">81</span> + <span class="number">3503</span>*y^<span class="number">80</span> + <span class="number">1184</span>*y^<span class="number">79</span> + <span class="number">38471</span>*y^<span class="number">78</span> + <span class="number">8012</span>*y^<span class="number">77</span> + <span class="number">36561</span>*y^<span class="number">76</span> + <span class="number">19429</span>*y^<span class="number">75</span> + <span class="number">35227</span>*y^<span class="number">74</span> + <span class="number">10813</span>*y^<span class="number">73</span> + <span class="number">26341</span>*y^<span class="number">72</span> + <span class="number">29474</span>*y^<span class="number">71</span> + <span class="number">2059</span>*y^<span class="number">70</span> + <span class="number">16068</span>*y^<span class="number">69</span> + <span class="number">31597</span>*y^<span class="number">68</span> + <span class="number">14685</span>*y^<span class="number">67</span> + <span class="number">9266</span>*y^<span class="number">66</span> + <span class="number">31019</span>*y^<span class="number">65</span> + <span class="number">6171</span>*y^<span class="number">64</span> + <span class="number">385</span>*y^<span class="number">63</span> + <span class="number">28986</span>*y^<span class="number">62</span> + <span class="number">9912</span>*y^<span class="number">61</span> + <span class="number">10632</span>*y^<span class="number">60</span> + <span class="number">33741</span>*y^<span class="number">59</span> + <span class="number">12634</span>*y^<span class="number">58</span> + <span class="number">21179</span>*y^<span class="number">57</span> + <span class="number">35548</span>*y^<span class="number">56</span> + <span class="number">17894</span>*y^<span class="number">55</span> + <span class="number">7152</span>*y^<span class="number">54</span> + <span class="number">9440</span>*y^<span class="number">53</span> + <span class="number">4004</span>*y^<span class="number">52</span> + <span class="number">2600</span>*y^<span class="number">51</span> + <span class="number">12281</span>*y^<span class="number">50</span> + <span class="number">22</span>*y^<span class="number">49</span> + <span class="number">17314</span>*y^<span class="number">48</span> + <span class="number">32694</span>*y^<span class="number">47</span> + <span class="number">7693</span>*y^<span class="number">46</span> + <span class="number">6567</span>*y^<span class="number">45</span> + <span class="number">19897</span>*y^<span class="number">44</span> + <span class="number">27329</span>*y^<span class="number">43</span> + <span class="number">8799</span>*y^<span class="number">42</span> + <span class="number">36348</span>*y^<span class="number">41</span> + <span class="number">33963</span>*y^<span class="number">40</span> + <span class="number">23730</span>*y^<span class="number">39</span> + <span class="number">27685</span>*y^<span class="number">38</span> + <span class="number">29037</span>*y^<span class="number">37</span> + <span class="number">14622</span>*y^<span class="number">36</span> + <span class="number">29608</span>*y^<span class="number">35</span> + <span class="number">39588</span>*y^<span class="number">34</span> + <span class="number">23294</span>*y^<span class="number">33</span> + <span class="number">757</span>*y^<span class="number">32</span> + <span class="number">20140</span>*y^<span class="number">31</span> + <span class="number">19511</span>*y^<span class="number">30</span> + <span class="number">1469</span>*y^<span class="number">29</span> + <span class="number">3898</span>*y^<span class="number">28</span> + <span class="number">6630</span>*y^<span class="number">27</span> + <span class="number">19610</span>*y^<span class="number">26</span> + <span class="number">11631</span>*y^<span class="number">25</span> + <span class="number">7188</span>*y^<span class="number">24</span> + <span class="number">11683</span>*y^<span class="number">23</span> + <span class="number">35611</span>*y^<span class="number">22</span> + <span class="number">37286</span>*y^<span class="number">21</span> + <span class="number">32139</span>*y^<span class="number">20</span> + <span class="number">20296</span>*y^<span class="number">19</span> + <span class="number">36426</span>*y^<span class="number">18</span> + <span class="number">25340</span>*y^<span class="number">17</span> + <span class="number">36204</span>*y^<span class="number">16</span> + <span class="number">37787</span>*y^<span class="number">15</span> + <span class="number">31256</span>*y^<span class="number">14</span> + <span class="number">505</span>*y^<span class="number">13</span> + <span class="number">27508</span>*y^<span class="number">12</span> + <span class="number">20885</span>*y^<span class="number">11</span> + <span class="number">32037</span>*y^<span class="number">10</span> + <span class="number">31236</span>*y^<span class="number">9</span> + <span class="number">7929</span>*y^<span class="number">8</span> + <span class="number">27195</span>*y^<span class="number">7</span> + <span class="number">28980</span>*y^<span class="number">6</span> + <span class="number">11863</span>*y^<span class="number">5</span> + <span class="number">16025</span>*y^<span class="number">4</span> + <span class="number">16389</span>*y^<span class="number">3</span> + <span class="number">570</span>*y^<span class="number">2</span> + <span class="number">36547</span>*y + <span class="number">10451</span></span><br><span class="line">C=<span class="number">3552</span>*x^<span class="number">92</span> + <span class="number">6082</span>*x^<span class="number">91</span> + <span class="number">25295</span>*x^<span class="number">90</span> + <span class="number">35988</span>*x^<span class="number">89</span> + <span class="number">26052</span>*x^<span class="number">88</span> + <span class="number">16987</span>*x^<span class="number">87</span> + <span class="number">12854</span>*x^<span class="number">86</span> + <span class="number">25117</span>*x^<span class="number">85</span> + <span class="number">25800</span>*x^<span class="number">84</span> + <span class="number">30297</span>*x^<span class="number">83</span> + <span class="number">5589</span>*x^<span class="number">82</span> + <span class="number">23233</span>*x^<span class="number">81</span> + <span class="number">14449</span>*x^<span class="number">80</span> + <span class="number">4712</span>*x^<span class="number">79</span> + <span class="number">35719</span>*x^<span class="number">78</span> + <span class="number">1696</span>*x^<span class="number">77</span> + <span class="number">35653</span>*x^<span class="number">76</span> + <span class="number">13995</span>*x^<span class="number">75</span> + <span class="number">13715</span>*x^<span class="number">74</span> + <span class="number">4578</span>*x^<span class="number">73</span> + <span class="number">37366</span>*x^<span class="number">72</span> + <span class="number">25260</span>*x^<span class="number">71</span> + <span class="number">28865</span>*x^<span class="number">70</span> + <span class="number">36120</span>*x^<span class="number">69</span> + <span class="number">7047</span>*x^<span class="number">68</span> + <span class="number">10497</span>*x^<span class="number">67</span> + <span class="number">19160</span>*x^<span class="number">66</span> + <span class="number">17939</span>*x^<span class="number">65</span> + <span class="number">14850</span>*x^<span class="number">64</span> + <span class="number">6705</span>*x^<span class="number">63</span> + <span class="number">17805</span>*x^<span class="number">62</span> + <span class="number">30083</span>*x^<span class="number">61</span> + <span class="number">2400</span>*x^<span class="number">60</span> + <span class="number">10685</span>*x^<span class="number">59</span> + <span class="number">15272</span>*x^<span class="number">58</span> + <span class="number">2225</span>*x^<span class="number">57</span> + <span class="number">13194</span>*x^<span class="number">56</span> + <span class="number">14251</span>*x^<span class="number">55</span> + <span class="number">31016</span>*x^<span class="number">54</span> + <span class="number">10189</span>*x^<span class="number">53</span> + <span class="number">35040</span>*x^<span class="number">52</span> + <span class="number">7042</span>*x^<span class="number">51</span> + <span class="number">29206</span>*x^<span class="number">50</span> + <span class="number">39363</span>*x^<span class="number">49</span> + <span class="number">32608</span>*x^<span class="number">48</span> + <span class="number">38614</span>*x^<span class="number">47</span> + <span class="number">5528</span>*x^<span class="number">46</span> + <span class="number">20119</span>*x^<span class="number">45</span> + <span class="number">13439</span>*x^<span class="number">44</span> + <span class="number">25468</span>*x^<span class="number">43</span> + <span class="number">30056</span>*x^<span class="number">42</span> + <span class="number">19720</span>*x^<span class="number">41</span> + <span class="number">21808</span>*x^<span class="number">40</span> + <span class="number">3712</span>*x^<span class="number">39</span> + <span class="number">25243</span>*x^<span class="number">38</span> + <span class="number">10606</span>*x^<span class="number">37</span> + <span class="number">16247</span>*x^<span class="number">36</span> + <span class="number">36106</span>*x^<span class="number">35</span> + <span class="number">17287</span>*x^<span class="number">34</span> + <span class="number">36276</span>*x^<span class="number">33</span> + <span class="number">1407</span>*x^<span class="number">32</span> + <span class="number">28839</span>*x^<span class="number">31</span> + <span class="number">8459</span>*x^<span class="number">30</span> + <span class="number">38863</span>*x^<span class="number">29</span> + <span class="number">435</span>*x^<span class="number">28</span> + <span class="number">913</span>*x^<span class="number">27</span> + <span class="number">36619</span>*x^<span class="number">26</span> + <span class="number">15572</span>*x^<span class="number">25</span> + <span class="number">9363</span>*x^<span class="number">24</span> + <span class="number">36837</span>*x^<span class="number">23</span> + <span class="number">17925</span>*x^<span class="number">22</span> + <span class="number">38567</span>*x^<span class="number">21</span> + <span class="number">38709</span>*x^<span class="number">20</span> + <span class="number">13582</span>*x^<span class="number">19</span> + <span class="number">35038</span>*x^<span class="number">18</span> + <span class="number">31121</span>*x^<span class="number">17</span> + <span class="number">8933</span>*x^<span class="number">16</span> + <span class="number">1666</span>*x^<span class="number">15</span> + <span class="number">21940</span>*x^<span class="number">14</span> + <span class="number">25585</span>*x^<span class="number">13</span> + <span class="number">840</span>*x^<span class="number">12</span> + <span class="number">21938</span>*x^<span class="number">11</span> + <span class="number">20143</span>*x^<span class="number">10</span> + <span class="number">28507</span>*x^<span class="number">9</span> + <span class="number">5947</span>*x^<span class="number">8</span> + <span class="number">20289</span>*x^<span class="number">7</span> + <span class="number">32196</span>*x^<span class="number">6</span> + <span class="number">924</span>*x^<span class="number">5</span> + <span class="number">370</span>*x^<span class="number">4</span> + <span class="number">14849</span>*x^<span class="number">3</span> + <span class="number">10780</span>*x^<span class="number">2</span> + <span class="number">14035</span>*x + <span class="number">15327</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">roots = factor(N)</span><br><span class="line">P = roots[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">Q = roots[<span class="number">1</span>][<span class="number">0</span>]</span><br><span class="line">PHI = (p^P.degree()-<span class="number">1</span>)*(p^Q.degree()-<span class="number">1</span>)</span><br><span class="line">D = <span class="built_in">int</span>(gmpy2.invert(e, PHI))</span><br><span class="line">M = <span class="built_in">pow</span>(C,D,N)</span><br><span class="line"><span class="built_in">print</span>(M)</span><br><span class="line">hint = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> M])</span><br><span class="line"><span class="built_in">print</span>(hint)</span><br><span class="line"><span class="comment"># NKCTF&#123;We_HaV3_n0th1ng_But_dr3amS&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="eZ-Bl⊕ck"><a href="#eZ-Bl⊕ck" class="headerlink" title="eZ_Bl⊕ck"></a>eZ_Bl⊕ck</h3><h4 id="题目-6"><a href="#题目-6" class="headerlink" title="题目"></a>题目</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> strxor <span class="keyword">as</span> xor</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">round</span>(<span class="params">s, k</span>):</span></span><br><span class="line">    l, r = s[:<span class="number">16</span>], s[<span class="number">16</span>:]</span><br><span class="line">    l_, r_ = xor(xor(r, k), l), l</span><br><span class="line">    <span class="keyword">return</span> l_ + r_</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encode</span>(<span class="params">s, k</span>):</span></span><br><span class="line">    t = s</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        t = <span class="built_in">round</span>(t, k[i])</span><br><span class="line">    <span class="keyword">return</span> t</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r = os.urandom(<span class="number">32</span>)</span><br><span class="line"><span class="built_in">print</span>(r)</span><br><span class="line"></span><br><span class="line">key = [os.urandom(<span class="number">16</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(encode(r, key))</span><br><span class="line">m = flag.strip(<span class="string">b&#x27;NKCTF&#123;&#x27;</span>).strip(<span class="string">b&#x27;&#125;&#x27;</span>).replace(<span class="string">b&#x27;-&#x27;</span>, <span class="string">b&#x27;&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(encode(m, key))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&quot;t\xf7\xaa\xac\x9d\x88\xa4\x8b\x1f+pA\x84\xacHg&#x27;\x07&#123;\xcc\x06\xc4i\xdd)\xda\xc9\xad\xa9\xe8\x1fi&quot;</span></span><br><span class="line"><span class="comment"># b&quot;&#x27;&#123;&lt;z&#125;\x91\xda\xc5\xd5S\x8b\xfa\x9f~]J\x0f\xf4\x9a\x1e\xe0\xef\x129N\xe7a\x928+\xe0\xee&quot;</span></span><br><span class="line"><span class="comment"># b&#x27;8\x1f&quot;\x83B4\x86)\xce\xebq3\x06\xa0w\x16U\x04M/w\xa1\x8f;)M\xdd~\x11:\xe3\xb3&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="题解-6"><a href="#题解-6" class="headerlink" title="题解"></a>题解</h4><p>手动浅推一下，会发现r加密和flag加密后的“格式”是一致的，所以两者对应分段异或能消去key</p>
<p>在不具体推理其余变量的情况下，可以直接尝试异或所有可能分段，即解</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> strxor <span class="keyword">as</span> xor</span><br><span class="line"></span><br><span class="line">r = <span class="string">b&quot;t\xf7\xaa\xac\x9d\x88\xa4\x8b\x1f+pA\x84\xacHg&#x27;\x07&#123;\xcc\x06\xc4i\xdd)\xda\xc9\xad\xa9\xe8\x1fi&quot;</span></span><br><span class="line">enc1 = <span class="string">b&quot;&#x27;&#123;&lt;z&#125;\x91\xda\xc5\xd5S\x8b\xfa\x9f~]J\x0f\xf4\x9a\x1e\xe0\xef\x129N\xe7a\x928+\xe0\xee&quot;</span></span><br><span class="line">enc2 = <span class="string">b&#x27;8\x1f&quot;\x83B4\x86)\xce\xebq3\x06\xa0w\x16U\x04M/w\xa1\x8f;)M\xdd~\x11:\xe3\xb3&#x27;</span></span><br><span class="line">t1 = xor(enc2[:<span class="number">16</span>], enc1[:<span class="number">16</span>])</span><br><span class="line">t2 = xor(enc2[<span class="number">16</span>:], enc1[<span class="number">16</span>:])</span><br><span class="line">r1 = r[:<span class="number">16</span>]</span><br><span class="line">r2 = r[<span class="number">16</span>:]</span><br><span class="line"><span class="comment"># print(xor(t1, r1))</span></span><br><span class="line"><span class="comment"># print(xor(t2, r1))</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(xor(t1, r2))  <span class="comment"># this</span></span><br><span class="line">flag1 = xor(t1, r2)</span><br><span class="line"><span class="comment"># print(xor(t2, r2))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(xor(xor(t1, r1), r2))</span></span><br><span class="line"><span class="comment"># print(xor(xor(t2, r1), r2))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(xor(t2, r1))</span></span><br><span class="line"><span class="comment"># print(xor(t2, r2))</span></span><br><span class="line"><span class="comment"># print(xor(xor(t2, r1), r2))</span></span><br><span class="line">tt = xor(t2, flag1)</span><br><span class="line"><span class="comment"># print(xor(tt, r1))</span></span><br><span class="line"><span class="comment"># print(xor(tt, r2))</span></span><br><span class="line"><span class="built_in">print</span>(xor(xor(tt, r1), r2))  <span class="comment">#  this</span></span><br><span class="line">flag2 = xor(xor(tt, r1), r2)</span><br><span class="line"><span class="built_in">print</span>(flag2+flag1)  <span class="comment"># 改为UUID格式</span></span><br><span class="line"><span class="comment"># NKCTF&#123;1ccd5cee-c96d-4caf-8ce5-9a512b3d0655&#125;</span></span><br></pre></td></tr></table></figure>


<h3 id="easy-high"><a href="#easy-high" class="headerlink" title="easy_high"></a>easy_high</h3><h4 id="题目-7"><a href="#题目-7" class="headerlink" title="题目"></a>题目</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">p, q = getPrime(<span class="number">1024</span>), getPrime(<span class="number">1024</span>)</span><br><span class="line">N = p * q</span><br><span class="line">p0 = p ^ (bytes_to_long(flag)&lt;&lt;<span class="number">444</span>)</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m, <span class="number">65537</span>, N)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c=&#x27;</span>,c)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;N=&#x27;</span>,N)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;p0=&#x27;</span>,p0)</span><br><span class="line"></span><br><span class="line"><span class="comment">#c= 4881545863615247924697512170011400857004555681758106351259776881249360423774694437921554056529064037535796844084045263140567168171628832384672612945806728465127954937293787045302307135365408938448006548465000663247116917564500525499976139556325841597810084111303039525833367199565266613007333465332710833102978756654324956219855687611590278570749890543277201538208370370097424105751568285050703167350889953331829275262932104042040526209179357770495596739361176548337593674366015027648541293309465113202672923556991818236011769228078267484362980348613669012975963468592763463397575879215173972436831753615524193609612</span></span><br><span class="line"><span class="comment">#N= 17192509201635459965397076685948071839556595198733884616568925970608227408244870123644193452116734188924766414178232653941867668088060274364830452998991993756231372252367134508712447410029668020439498980619263308413952840568602285764163331028384281840387206878673090608323292785024372223569438874557728414737773416206032540038861064700108597448191546413236875600906013508022023794395360001242071569785940215873854748631691555516626235191098174739613181230094797844414203694879874212340812119576042962565179579136753839946922829803044355134086779223242080575811804564731938746051591474236147749401914216734714709281349</span></span><br><span class="line"><span class="comment">#p0= 149263925308155304734002881595820602641174737629551638146384199378753884153459661375931646716325020758837194837271581361322079811468970876532640273110966545339040194118880506352109559900553776706613338890047890747811129988585025948270181264314668772556874718178868209009192010129918138140332707080927643141811</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="题解-7"><a href="#题解-7" class="headerlink" title="题解"></a>题解</h4><p>通过p0能得到p高位以及p低444位数据，设p中间位，coppersmith求解后即可rsa解密得到flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum, gmpy2</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c= <span class="number">4881545863615247924697512170011400857004555681758106351259776881249360423774694437921554056529064037535796844084045263140567168171628832384672612945806728465127954937293787045302307135365408938448006548465000663247116917564500525499976139556325841597810084111303039525833367199565266613007333465332710833102978756654324956219855687611590278570749890543277201538208370370097424105751568285050703167350889953331829275262932104042040526209179357770495596739361176548337593674366015027648541293309465113202672923556991818236011769228078267484362980348613669012975963468592763463397575879215173972436831753615524193609612</span></span><br><span class="line">N= <span class="number">17192509201635459965397076685948071839556595198733884616568925970608227408244870123644193452116734188924766414178232653941867668088060274364830452998991993756231372252367134508712447410029668020439498980619263308413952840568602285764163331028384281840387206878673090608323292785024372223569438874557728414737773416206032540038861064700108597448191546413236875600906013508022023794395360001242071569785940215873854748631691555516626235191098174739613181230094797844414203694879874212340812119576042962565179579136753839946922829803044355134086779223242080575811804564731938746051591474236147749401914216734714709281349</span></span><br><span class="line">p0= <span class="number">149263925308155304734002881595820602641174737629551638146384199378753884153459661375931646716325020758837194837271581361322079811468970876532640273110966545339040194118880506352109559900553776706613338890047890747811129988585025948270181264314668772556874718178868209009192010129918138140332707080927643141811</span></span><br><span class="line">flag_len = <span class="number">400</span></span><br><span class="line">p_high =(p0&gt;&gt;(flag_len+<span class="number">444</span>))&lt;&lt;<span class="number">400</span>+<span class="number">444</span></span><br><span class="line"></span><br><span class="line">p_low = p0%(<span class="number">2</span>^<span class="number">444</span>)</span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(N))</span><br><span class="line">f = p_high+x*<span class="number">2</span>^<span class="number">444</span>+p_low</span><br><span class="line">f = f.monic()</span><br><span class="line">x = f.small_roots(X=<span class="number">2</span>^flag_len, beta=<span class="number">0.4</span>)</span><br><span class="line"><span class="built_in">print</span>(x)</span><br><span class="line">p = <span class="built_in">int</span>(p_high+x[<span class="number">0</span>]*<span class="number">2</span>^<span class="number">444</span>+p_low)</span><br><span class="line">q = N//p</span><br><span class="line"><span class="built_in">print</span>(p)</span><br><span class="line"><span class="built_in">print</span>(q)</span><br><span class="line"></span><br><span class="line">d = <span class="built_in">int</span>(gmpy2.invert(e, (p-<span class="number">1</span>)*(q-<span class="number">1</span>)))</span><br><span class="line">m = <span class="built_in">int</span>(<span class="built_in">pow</span>(c, d, N))</span><br><span class="line"><span class="built_in">print</span>(libnum.n2s(m))</span><br><span class="line"><span class="comment"># NKCTF&#123;F10wrs_hVe_r3strDay&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="eZ-LargeCG"><a href="#eZ-LargeCG" class="headerlink" title="eZ_LargeCG"></a>eZ_LargeCG</h3><h4 id="题目-8"><a href="#题目-8" class="headerlink" title="题目"></a>题目</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> next_prime</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, isPrime, bytes_to_long</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init</span>():</span></span><br><span class="line">    primes = []</span><br><span class="line">    p = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(primes) &lt; <span class="number">100</span>:</span><br><span class="line">        p = next_prime(p)</span><br><span class="line">        primes.append(<span class="built_in">int</span>(p))</span><br><span class="line">    <span class="keyword">return</span> primes</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">genMyPrimeA</span>(<span class="params">bits</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        g = <span class="number">2</span></span><br><span class="line">        <span class="keyword">while</span> g &lt; <span class="number">2</span> ** bits:</span><br><span class="line">            g *= random.choice(primes)</span><br><span class="line">        g += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> isPrime(g):</span><br><span class="line">            <span class="keyword">return</span> g</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">genMyPrimeB</span>(<span class="params">bits</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        g = <span class="number">2</span></span><br><span class="line">        <span class="keyword">while</span> g &lt; <span class="number">2</span> ** bits:</span><br><span class="line">            g *= random.choice(primes)</span><br><span class="line">        g -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> isPrime(g):</span><br><span class="line">            <span class="keyword">return</span> g</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen</span>(<span class="params">st, n, a, b, c, d</span>):</span></span><br><span class="line">    A = [st + <span class="number">2023</span>, st + <span class="number">2024</span>, st + <span class="number">2025</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>**<span class="number">666</span>):</span><br><span class="line">        A.append((a * A[-<span class="number">3</span>] + b * A[-<span class="number">2</span>] + c * A[-<span class="number">1</span>] + d) % n)</span><br><span class="line">    <span class="keyword">return</span> A</span><br><span class="line"></span><br><span class="line">primes = init()</span><br><span class="line">p1 = getPrime(<span class="number">256</span>)</span><br><span class="line"><span class="built_in">print</span>(p1)</span><br><span class="line">q1 = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> p1 &gt; q1:</span><br><span class="line">    q1 = genMyPrimeA(<span class="number">256</span>)</span><br><span class="line"><span class="built_in">print</span>(q1)</span><br><span class="line">p2 = getPrime(<span class="number">256</span>)</span><br><span class="line">q2 = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> p2 &gt; q2:</span><br><span class="line">    q2 = genMyPrimeB(<span class="number">256</span>)</span><br><span class="line">n1 = p1 * q1</span><br><span class="line">n2 = p2 * q2</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n1 = <span class="subst">&#123;n1&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n2 = <span class="subst">&#123;n2&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r = getPrime(<span class="number">512</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;r = <span class="subst">&#123;r&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">A = gen(bytes_to_long(flag), r, p1, q1, p2, q2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;A[-3] = <span class="subst">&#123;A[-<span class="number">3</span>]&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;A[-2] = <span class="subst">&#123;A[-<span class="number">2</span>]&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;A[-1] = <span class="subst">&#123;A[-<span class="number">1</span>]&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># n1 = 39755206609675677517559022219519767646524455449142889144073217274247893104711318356648198334858966762944109142752432641040037415587397244438634301062818169</span></span><br><span class="line"><span class="comment"># n2 = 30725253491966558227957591684441310073288683324213439179377278006583428660031769862224980605664642101191616868994066039054762100886678504154619135365646221</span></span><br><span class="line"><span class="comment"># r = 7948275435515074902473978567170931671982245044864706132834233483354166398627204583162848756424199888842910697874390403881343013872330344844971750121043493</span></span><br><span class="line"><span class="comment"># A[-3] = 6085327340671394838391386566774092636784105046872311226269065664501131836034666722102264842236327898770287752026397099940098916322051606027565395747098434</span></span><br><span class="line"><span class="comment"># A[-2] = 1385551782355619987198268805270109182589006873371541520953112424858566073422289235930944613836387546298080386848159955053303343649615385527645536504580787</span></span><br><span class="line"><span class="comment"># A[-1] = 2529291156468264643335767070801583140819639532551726975314270127875306069067016825677707064451364791677536138503947465612206191051563106705150921639560469</span></span><br></pre></td></tr></table></figure>

<h4 id="题解-8"><a href="#题解-8" class="headerlink" title="题解"></a>题解</h4><p>原题，参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_51507437/article/details/124205732">https://blog.csdn.net/m0_51507437/article/details/124205732</a></p>
<ol>
<li>p-1/p+1光滑分解n</li>
<li>矩阵快速幂</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">from gmpy2 import *</span></span><br><span class="line"><span class="string">from primefac import *</span></span><br><span class="line"><span class="string">n1 = 39755206609675677517559022219519767646524455449142889144073217274247893104711318356648198334858966762944109142752432641040037415587397244438634301062818169</span></span><br><span class="line"><span class="string">n2 = 30725253491966558227957591684441310073288683324213439179377278006583428660031769862224980605664642101191616868994066039054762100886678504154619135365646221</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">N = n1</span></span><br><span class="line"><span class="string">a = 2</span></span><br><span class="line"><span class="string">n = 2</span></span><br><span class="line"><span class="string">while True:</span></span><br><span class="line"><span class="string">    a = powmod(a, n, N)</span></span><br><span class="line"><span class="string">    res = gcd(a-1, N)</span></span><br><span class="line"><span class="string">    if res != 1 and res != N:</span></span><br><span class="line"><span class="string">        q1 = N // res</span></span><br><span class="line"><span class="string">        p1 = res</span></span><br><span class="line"><span class="string">        print(p1)</span></span><br><span class="line"><span class="string">        print(q1)</span></span><br><span class="line"><span class="string">        break</span></span><br><span class="line"><span class="string">    n += 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">def mlucas(v, a, n):</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span> Helper function <span class="keyword">for</span> williams_pp1().  Multiplies along a Lucas sequence modulo n. <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    v1, v2 = v, (v**2 - 2) % n</span></span><br><span class="line"><span class="string">    for bit in bin(a)[3:]: v1, v2 = ((v1**2 - 2) % n, (v1*v2 - v) % n) if bit == &quot;0&quot; else ((v1*v2 - v) % n, (v2**2 - 2) % n)</span></span><br><span class="line"><span class="string">    return v1</span></span><br><span class="line"><span class="string">n = n2</span></span><br><span class="line"><span class="string">for v in count(1):</span></span><br><span class="line"><span class="string">    for p in primegen():</span></span><br><span class="line"><span class="string">        e = ilog(isqrt(n), p)</span></span><br><span class="line"><span class="string">        if e == 0: break</span></span><br><span class="line"><span class="string">        for _ in range(e): v = mlucas(v, p, n)</span></span><br><span class="line"><span class="string">        g = gcd(v-2, n)</span></span><br><span class="line"><span class="string">        if 1 &lt; g &lt; n:</span></span><br><span class="line"><span class="string">            p2 = g</span></span><br><span class="line"><span class="string">            q2 = n2//p2</span></span><br><span class="line"><span class="string">            print(p2)</span></span><br><span class="line"><span class="string">            print(q2)</span></span><br><span class="line"><span class="string">            exit(0)</span></span><br><span class="line"><span class="string">        if g == n: break</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">x = <span class="number">6085327340671394838391386566774092636784105046872311226269065664501131836034666722102264842236327898770287752026397099940098916322051606027565395747098434</span></span><br><span class="line">y = <span class="number">1385551782355619987198268805270109182589006873371541520953112424858566073422289235930944613836387546298080386848159955053303343649615385527645536504580787</span></span><br><span class="line">z = <span class="number">2529291156468264643335767070801583140819639532551726975314270127875306069067016825677707064451364791677536138503947465612206191051563106705150921639560469</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># def gen(st, n, a, b, c, d):</span></span><br><span class="line"><span class="comment"># A = gen(bytes_to_long(flag), r, p1, q1, p2, q2)</span></span><br><span class="line">n1 = <span class="number">39755206609675677517559022219519767646524455449142889144073217274247893104711318356648198334858966762944109142752432641040037415587397244438634301062818169</span></span><br><span class="line">n2 = <span class="number">30725253491966558227957591684441310073288683324213439179377278006583428660031769862224980605664642101191616868994066039054762100886678504154619135365646221</span></span><br><span class="line">p1 = <span class="number">427721675251610827084310512123962488210068003845592404231631542730839819224381</span></span><br><span class="line">q1 = <span class="number">92946439027877993602295703905130336736159270745389239059083263513478865293549</span></span><br><span class="line">p2 = <span class="number">288551157776490110472645044398395422160196115791981535735903775378294599329633</span></span><br><span class="line">q2 = n2//p2</span><br><span class="line">r = <span class="number">7948275435515074902473978567170931671982245044864706132834233483354166398627204583162848756424199888842910697874390403881343013872330344844971750121043493</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> p1 &gt; q1:</span><br><span class="line">    p1, q1 = q1, p1</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> p2 &gt; q2:</span><br><span class="line">    p2, q2 = q2, p2</span><br><span class="line">a = p1</span><br><span class="line">b = q1</span><br><span class="line">c = p2</span><br><span class="line">d =q2</span><br><span class="line">mt=matrix(Zmod(r),<span class="number">4</span>,<span class="number">4</span>)</span><br><span class="line">mt[<span class="number">0</span>]=[c,b,a,d]</span><br><span class="line">mt[<span class="number">1</span>]=[<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">mt[<span class="number">2</span>]=[<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">mt[<span class="number">3</span>]=[<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">mn=matrix(Zmod(r),<span class="number">4</span>,<span class="number">1</span>,[z,y,x,<span class="number">1</span>])</span><br><span class="line"><span class="comment"># 6**666</span></span><br><span class="line">X=(mt^(<span class="built_in">pow</span>(<span class="number">6</span>,<span class="number">666</span>))).solve_right(mn)</span><br><span class="line">flag = X[<span class="number">2</span>][<span class="number">0</span>]-<span class="number">2023</span></span><br><span class="line"><span class="built_in">print</span>(libnum.n2s(<span class="built_in">int</span>(flag)))</span><br><span class="line"><span class="comment"># NKCTF&#123;y0u_kN0w_r5A_&amp;_LCg_&amp;_Ma7r1X_s0_w3ll!!!&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="complex-matrix"><a href="#complex-matrix" class="headerlink" title="complex_matrix"></a>complex_matrix</h3><h4 id="题目-9"><a href="#题目-9" class="headerlink" title="题目"></a>题目</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2 <span class="keyword">as</span> gy</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">k = <span class="number">400</span></span><br><span class="line">p, q = getPrime(<span class="number">741</span>), getPrime(<span class="number">741</span>)</span><br><span class="line">N = p * q</span><br><span class="line">phi = (p-<span class="number">1</span>) * (q-<span class="number">1</span>)</span><br><span class="line">_flag = bytes_to_long(flag)</span><br><span class="line">p, q = getPrime(<span class="number">1024</span>), getPrime(<span class="number">1024</span>)</span><br><span class="line">d_array = [getPrime(k) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)] </span><br><span class="line">e_array = [inverse(i, phi) <span class="keyword">for</span> i <span class="keyword">in</span> d_array]</span><br><span class="line">c = <span class="built_in">pow</span>(_flag, <span class="number">65537</span>, N)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;N:&#x27;</span>,N)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;e:&#x27;</span>,e_array)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c:&#x27;</span>,c)</span><br><span class="line"></span><br><span class="line"><span class="comment">#N: 71841248095369087024928175623295380241516644434969868335504061065977014103487197287619667598363486210886674500469383623511906399909335989202774281795855975972913438448899231650449810696539722877903606541112937729384851506921675290984316325565141178015123381439392534417225128922398194700511937668809140024838070124095703585627058463137549632965723304713166804084673075651182998654091113119667582720831809458721072371364839503563819080226784026253</span></span><br><span class="line"><span class="comment">#e: [65128799196671634905309494529154568614228788035735808211836905142007976099865571126946706559109393187772126407982007858423859147772762638898854472065889939549916077695303157760259717113616428849798058080633047516455513870697383339784816006154279428812359241282979297285283850338964993773227397528608557211742425548651971558377656644211835094019462699301650412862894391885325969143805924684662849869947172175608502179438901337558870349697233790535, 58756559706647121529575085912021603170286163639572075337348109911506627489265537716060463072086480156516641723700802217411122982693536541892986623158818442274840863016647800896033363360822503445344748132842451806511693779600370832206455202293028402486647422212959763287987847280322100701242139127654031151565924132562837893975505159702015125483479126108892709063135006366792197127007229210558758401679638300464111782814561428899998471531067163715, 34828685390969672139784723764579499920301439564705391196519314224159563070870933754477650614819514127121146216049444888554338415587165719098661141454627820126445291802801256297252654045398330613075575527685542980264993711077876535643646746742646371967302159565887123638001580042027272379341650995728849759541960087953160211696369079708787543303742132161742979856720539914370868829868891655221361545648778590685232034703220732697083024449894197969, 26717968456600556973167180286909817773394160817933525240720067057464671317174201540556176814203780603153696663101158205367554829261808020426363683474848952397963507069306452835776851274959389849223566030857588019845781623271395012194869024566879791449466064832273531795430185178486425688475688634844530106740480643866537205900809400383304665727460014210405339697947582657505028211149470787536144302545259243549176816653560626044921521516818788487]</span></span><br><span class="line"><span class="comment">#c: 39297018404565022956251803918747154798377576057123078716166221329195959669756819453426741569480551313085435037629493881038383709458043802420338889323233368852331387845200216275712388921820794980987541224782392553528127093154957890356084331463340193478391679540506421250562554424770350351514435220782124981277580072039637811543914983033300225131364246910828188727043248991987332274929827173923543187017105236008487756190002204169623313222748976369</span></span><br></pre></td></tr></table></figure>

<h4 id="题解-9"><a href="#题解-9" class="headerlink" title="题解"></a>题解</h4><p>西湖论剑2021原题，参考<a target="_blank" rel="noopener" href="https://www.ctfer.vip/note/set/51">https://www.ctfer.vip/note/set/51</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line">isdigit = <span class="keyword">lambda</span> x: <span class="built_in">ord</span>(<span class="string">&#x27;0&#x27;</span>) &lt;= <span class="built_in">ord</span>(x) &lt;= <span class="built_in">ord</span>(<span class="string">&#x27;9&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_permutations</span>(<span class="params">g, n</span>):</span></span><br><span class="line">    sub = []</span><br><span class="line">    res = []</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dfs</span>(<span class="params">s, prev</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(s) == n:</span><br><span class="line">            res.append(s[::])</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> g:</span><br><span class="line">            <span class="keyword">if</span> i <span class="keyword">in</span> s <span class="keyword">or</span> i &lt; prev:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            s.append(i)</span><br><span class="line">            dfs(s, <span class="built_in">max</span>(prev, i))</span><br><span class="line">            s.remove(i)</span><br><span class="line">    dfs(sub, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">X3NNY</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, exp1, exp2</span>):</span></span><br><span class="line">        self.exp1 = exp1</span><br><span class="line">        self.exp2 = exp2</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__mul__</span>(<span class="params">self, b</span>):</span></span><br><span class="line">        <span class="keyword">return</span> X3NNY(self.exp1 * b.exp1, self.exp2 * b.exp2)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;%s = %s&#x27;</span> % (self.exp1.expand().collect_common_factors(), self.exp2)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">X_Complex</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, exp</span>):</span></span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        s = <span class="string">&#x27;%s&#x27;</span> % exp</span><br><span class="line">        <span class="keyword">while</span> i &lt; <span class="built_in">len</span>(s):</span><br><span class="line">            <span class="keyword">if</span> isdigit(s[i]):</span><br><span class="line">                num = <span class="number">0</span></span><br><span class="line">                <span class="keyword">while</span> i &lt; <span class="built_in">len</span>(s) <span class="keyword">and</span> isdigit(s[i]):</span><br><span class="line">                    num = num*<span class="number">10</span> + <span class="built_in">int</span>(s[i])</span><br><span class="line">                    i += <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> i &gt;= <span class="built_in">len</span>(s):</span><br><span class="line">                    self.b = num</span><br><span class="line">                <span class="keyword">elif</span> s[i] == <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">                    self.a = num</span><br><span class="line">                    i += <span class="number">2</span></span><br><span class="line">                <span class="keyword">elif</span> s[i] == <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">                    i += <span class="number">1</span></span><br><span class="line">                    r = <span class="number">0</span></span><br><span class="line">                    <span class="keyword">while</span> i &lt; <span class="built_in">len</span>(s) <span class="keyword">and</span> isdigit(s[i]):</span><br><span class="line">                        r = r*<span class="number">10</span> + <span class="built_in">int</span>(s[i])</span><br><span class="line">                        i += <span class="number">1</span></span><br><span class="line">                    self.b = num/r</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(self, <span class="string">&#x27;a&#x27;</span>):</span><br><span class="line">            self.a = <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(self, <span class="string">&#x27;b&#x27;</span>):</span><br><span class="line">            self.b = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">WW</span>(<span class="params">e, d, k, g, N, s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> X3NNY(e*d*g-k*N, g+k*s)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">GG</span>(<span class="params">e1, e2, d1, d2, k1, k2</span>):</span></span><br><span class="line">    <span class="keyword">return</span> X3NNY(e1*d1*k2- e2*d2*k1, k2 - k1)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">W</span>(<span class="params">i</span>):</span></span><br><span class="line">    e = <span class="built_in">eval</span>(<span class="string">&quot;e%d&quot;</span> % i)</span><br><span class="line">    d = <span class="built_in">eval</span>(<span class="string">&quot;d%d&quot;</span> % i)</span><br><span class="line">    k = <span class="built_in">eval</span>(<span class="string">&quot;k%d&quot;</span> % i)</span><br><span class="line">    <span class="keyword">return</span> WW(e, d, k, g, N, s)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">G</span>(<span class="params">i, j</span>):</span></span><br><span class="line">    e1 = <span class="built_in">eval</span>(<span class="string">&quot;e%d&quot;</span> % i)</span><br><span class="line">    d1 = <span class="built_in">eval</span>(<span class="string">&quot;d%d&quot;</span> % i)</span><br><span class="line">    k1 = <span class="built_in">eval</span>(<span class="string">&quot;k%d&quot;</span> % i)</span><br><span class="line">    </span><br><span class="line">    e2 = <span class="built_in">eval</span>(<span class="string">&quot;e%d&quot;</span> % j)</span><br><span class="line">    d2 = <span class="built_in">eval</span>(<span class="string">&quot;d%d&quot;</span> % j)</span><br><span class="line">    k2 = <span class="built_in">eval</span>(<span class="string">&quot;k%d&quot;</span> % j)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> GG(e1, e2, d1, d2, k1, k2)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">R</span>(<span class="params">e, sn</span>):</span> <span class="comment"># min u max v</span></span><br><span class="line">    ret = X3NNY(<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">    n = <span class="built_in">max</span>(e)</span><br><span class="line">    nn = <span class="built_in">len</span>(e)</span><br><span class="line">    l = <span class="built_in">set</span>(i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, n+<span class="number">1</span>))</span><br><span class="line">    debug = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    u, v = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> e:</span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">1</span>:</span><br><span class="line">            ret *= W(<span class="number">1</span>)</span><br><span class="line">            debug += <span class="string">&#x27;W(%d)&#x27;</span> % i</span><br><span class="line">            nn -= <span class="number">1</span></span><br><span class="line">            l.remove(<span class="number">1</span>)</span><br><span class="line">            u += <span class="number">1</span></span><br><span class="line">        <span class="keyword">elif</span> i &gt; <span class="built_in">min</span>(l) <span class="keyword">and</span> <span class="built_in">len</span>(l) &gt;= <span class="number">2</span>*nn:</span><br><span class="line">            ret *= G(<span class="built_in">min</span>(l), i)</span><br><span class="line">            nn -= <span class="number">1</span></span><br><span class="line">            debug += <span class="string">&#x27;G(%d, %d)&#x27;</span> % (<span class="built_in">min</span>(l), i)</span><br><span class="line">            l.remove(<span class="built_in">min</span>(l))</span><br><span class="line">            l.remove(i)</span><br><span class="line">            v += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ret *= W(i)</span><br><span class="line">            l.remove(i)</span><br><span class="line">            debug += <span class="string">&#x27;W(%d)&#x27;</span> % i</span><br><span class="line">            nn -= <span class="number">1</span></span><br><span class="line">            u += <span class="number">1</span></span><br><span class="line">    <span class="comment"># print(debug, end = &#x27; &#x27;)</span></span><br><span class="line">    <span class="keyword">return</span> ret, u/<span class="number">2</span> + (sn - v) * a</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">H</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> [<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> [(), (<span class="number">1</span>,), (<span class="number">2</span>,), (<span class="number">1</span>, <span class="number">2</span>)]</span><br><span class="line">    ret = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>, n+<span class="number">1</span>):</span><br><span class="line">        ret.append((i,))</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, i):</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> my_permutations(<span class="built_in">range</span>(<span class="number">1</span>, i), j):</span><br><span class="line">                ret.append(<span class="built_in">tuple</span>(k + [i]))</span><br><span class="line">    <span class="keyword">return</span> H(<span class="number">2</span>) + ret</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">CC</span>(<span class="params">exp, n</span>):</span></span><br><span class="line">    cols = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>&lt;&lt;n)]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># split exp</span></span><br><span class="line">    texps = (<span class="string">&#x27;%s&#x27;</span> % exp.exp1.expand()).strip().split(<span class="string">&#x27; - &#x27;</span>)</span><br><span class="line">    ops = []</span><br><span class="line">    exps = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(texps)):</span><br><span class="line">        <span class="keyword">if</span> texps[i].find(<span class="string">&#x27; + &#x27;</span>) != -<span class="number">1</span>:</span><br><span class="line">            tmp = texps[i].split(<span class="string">&#x27; + &#x27;</span>)</span><br><span class="line">            ops.append(<span class="number">0</span>)</span><br><span class="line">            exps.append(tmp[<span class="number">0</span>])</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(tmp)):</span><br><span class="line">                ops.append(<span class="number">1</span>)</span><br><span class="line">                exps.append(tmp[i])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ops.append(<span class="number">0</span>)</span><br><span class="line">            exps.append(texps[i])</span><br><span class="line">    <span class="keyword">if</span> exps[<span class="number">0</span>][<span class="number">0</span>] == <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(exps)):</span><br><span class="line">            ops[i] = <span class="number">1</span>-ops[i]</span><br><span class="line">        exps[<span class="number">0</span>] = exps[<span class="number">0</span>][<span class="number">1</span>:]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        ops[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">    <span class="comment"># find e and N</span></span><br><span class="line">    l = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(exps)):</span><br><span class="line">        tmp = <span class="number">1</span> <span class="keyword">if</span> ops[i] <span class="keyword">else</span> -<span class="number">1</span></span><br><span class="line">        en = []</span><br><span class="line">        j = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> j &lt; <span class="built_in">len</span>(exps[i]):</span><br><span class="line">            <span class="keyword">if</span> exps[i][j] == <span class="string">&#x27;e&#x27;</span>:</span><br><span class="line">                num = <span class="number">0</span></span><br><span class="line">                j += <span class="number">1</span></span><br><span class="line">                <span class="keyword">while</span> isdigit(exps[i][j]):</span><br><span class="line">                    num = num*<span class="number">10</span> + <span class="built_in">int</span>(exps[i][j])</span><br><span class="line">                    j += <span class="number">1</span></span><br><span class="line">                tmp *= <span class="built_in">eval</span>(<span class="string">&#x27;e%d&#x27;</span> % num)</span><br><span class="line">                en.append(num)</span><br><span class="line">            <span class="keyword">elif</span> exps[i][j] == <span class="string">&#x27;N&#x27;</span>:</span><br><span class="line">                j += <span class="number">1</span></span><br><span class="line">                num = <span class="number">0</span></span><br><span class="line">                <span class="keyword">if</span> exps[i][j] == <span class="string">&#x27;^&#x27;</span>:</span><br><span class="line">                    j += <span class="number">1</span></span><br><span class="line">                    <span class="keyword">while</span> isdigit(exps[i][j]):</span><br><span class="line">                        num = num*<span class="number">10</span> + <span class="built_in">int</span>(exps[i][j])</span><br><span class="line">                        j += <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> num == <span class="number">0</span>:</span><br><span class="line">                    num = <span class="number">1</span></span><br><span class="line">                tmp *= <span class="built_in">eval</span>(<span class="string">&#x27;N**%d&#x27;</span> % num)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                j += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> tmp == <span class="number">1</span> <span class="keyword">or</span> tmp == -<span class="number">1</span>:</span><br><span class="line">            l.append((<span class="number">0</span>, ()))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            l.append((tmp, <span class="built_in">tuple</span>(<span class="built_in">sorted</span>(en))))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># construct h</span></span><br><span class="line">    mp = H(n)</span><br><span class="line">    <span class="keyword">for</span> val, en <span class="keyword">in</span> l:</span><br><span class="line">        cols[mp.index(en)] = val</span><br><span class="line">    <span class="comment"># print(cols)</span></span><br><span class="line">    <span class="keyword">return</span> cols</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">EWA</span>(<span class="params">n, elist, NN, alpha</span>):</span></span><br><span class="line">    mp = H(n)</span><br><span class="line">    var(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    S = [X_Complex(n*a)]</span><br><span class="line">    cols = [[<span class="number">1</span> <span class="keyword">if</span> i == <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>^n)]]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> mp[<span class="number">1</span>:]:</span><br><span class="line">        eL, s = R(i, n)</span><br><span class="line">        cols.append(CC(eL, n))</span><br><span class="line">        S.append(X_Complex(s))</span><br><span class="line">    </span><br><span class="line">    alphaA,alphaB = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> S:</span><br><span class="line">        alphaA = <span class="built_in">max</span>(i.a, alphaA)</span><br><span class="line">        alphaB = <span class="built_in">max</span>(i.b, alphaB)</span><br><span class="line">    <span class="comment"># print(alphaA, alphaB)</span></span><br><span class="line">    D = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(S)):</span><br><span class="line">        <span class="comment"># print((alphaA-S[i].a), (alphaB - S[i].b))</span></span><br><span class="line">        D.append(</span><br><span class="line">            <span class="built_in">int</span>(NN^((alphaA-S[i].a)*alpha + (alphaB - S[i].b)))</span><br><span class="line">        )</span><br><span class="line">    kw = &#123;<span class="string">&#x27;N&#x27;</span>: NN&#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(elist)):</span><br><span class="line">        kw[<span class="string">&#x27;e%d&#x27;</span> % (i+<span class="number">1</span>)] = elist[i]</span><br><span class="line"></span><br><span class="line">    B = Matrix(ZZ, Matrix(cols).T(**kw)) * diagonal_matrix(ZZ, D)</span><br><span class="line">    L = B.LLL(<span class="number">0.5</span>)</span><br><span class="line">    v = Matrix(ZZ, L[<span class="number">0</span>])</span><br><span class="line">    x = v * B**(-<span class="number">1</span>)</span><br><span class="line">    phi = <span class="built_in">int</span>(x[<span class="number">0</span>,<span class="number">1</span>]/x[<span class="number">0</span>,<span class="number">0</span>]*elist[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">return</span> phi</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">attack</span>(<span class="params">NN, elist, alpha</span>):</span></span><br><span class="line">    phi = EWA(<span class="built_in">len</span>(elist), elist, NN, alpha)</span><br><span class="line">    <span class="built_in">print</span>(phi)</span><br><span class="line">    <span class="keyword">return</span> phi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NN = <span class="number">71841248095369087024928175623295380241516644434969868335504061065977014103487197287619667598363486210886674500469383623511906399909335989202774281795855975972913438448899231650449810696539722877903606541112937729384851506921675290984316325565141178015123381439392534417225128922398194700511937668809140024838070124095703585627058463137549632965723304713166804084673075651182998654091113119667582720831809458721072371364839503563819080226784026253</span></span><br><span class="line">elist = [<span class="number">65128799196671634905309494529154568614228788035735808211836905142007976099865571126946706559109393187772126407982007858423859147772762638898854472065889939549916077695303157760259717113616428849798058080633047516455513870697383339784816006154279428812359241282979297285283850338964993773227397528608557211742425548651971558377656644211835094019462699301650412862894391885325969143805924684662849869947172175608502179438901337558870349697233790535</span>, <span class="number">58756559706647121529575085912021603170286163639572075337348109911506627489265537716060463072086480156516641723700802217411122982693536541892986623158818442274840863016647800896033363360822503445344748132842451806511693779600370832206455202293028402486647422212959763287987847280322100701242139127654031151565924132562837893975505159702015125483479126108892709063135006366792197127007229210558758401679638300464111782814561428899998471531067163715</span>, <span class="number">34828685390969672139784723764579499920301439564705391196519314224159563070870933754477650614819514127121146216049444888554338415587165719098661141454627820126445291802801256297252654045398330613075575527685542980264993711077876535643646746742646371967302159565887123638001580042027272379341650995728849759541960087953160211696369079708787543303742132161742979856720539914370868829868891655221361545648778590685232034703220732697083024449894197969</span>, <span class="number">26717968456600556973167180286909817773394160817933525240720067057464671317174201540556176814203780603153696663101158205367554829261808020426363683474848952397963507069306452835776851274959389849223566030857588019845781623271395012194869024566879791449466064832273531795430185178486425688475688634844530106740480643866537205900809400383304665727460014210405339697947582657505028211149470787536144302545259243549176816653560626044921521516818788487</span>]</span><br><span class="line">c = <span class="number">39297018404565022956251803918747154798377576057123078716166221329195959669756819453426741569480551313085435037629493881038383709458043802420338889323233368852331387845200216275712388921820794980987541224782392553528127093154957890356084331463340193478391679540506421250562554424770350351514435220782124981277580072039637811543914983033300225131364246910828188727043248991987332274929827173923543187017105236008487756190002204169623313222748976369</span></span><br><span class="line">alpha = <span class="number">400</span> / <span class="built_in">int</span>(NN).bit_length()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(elist)+<span class="number">1</span>):</span><br><span class="line">    var(<span class="string">&quot;e%d&quot;</span> % i)</span><br><span class="line">    var(<span class="string">&quot;d%d&quot;</span> % i)</span><br><span class="line">    var(<span class="string">&quot;k%d&quot;</span> % i)</span><br><span class="line">g, N, s = var(<span class="string">&#x27;g&#x27;</span>), var(<span class="string">&#x27;N&#x27;</span>), var(<span class="string">&#x27;s&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(elist)):</span><br><span class="line">    elist[i] = Integer(elist[i])</span><br><span class="line">phi = attack(NN, elist, alpha)</span><br><span class="line"></span><br><span class="line">d = gmpy2.invert(<span class="number">65537</span>, phi)</span><br><span class="line">m = <span class="built_in">int</span>(<span class="built_in">pow</span>(c, d, NN))</span><br><span class="line"><span class="built_in">print</span>(libnum.n2s(m))</span><br><span class="line"><span class="comment"># NKCTF&#123;F10w3r_Hav3_r3start_Day_N0_Man_iS_Y0ung_Aga1n&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="baby-classical"><a href="#baby-classical" class="headerlink" title="baby_classical"></a>baby_classical</h3><h4 id="题目-10"><a href="#题目-10" class="headerlink" title="题目"></a>题目</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;flag length:&#x27;</span>,<span class="built_in">len</span>(flag))</span><br><span class="line">dic = string.ascii_uppercase+string.ascii_lowercase+string.digits+<span class="string">&#x27;+/&#x27;</span></span><br><span class="line">f1nd = <span class="keyword">lambda</span> x : dic.find(x)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KeyEncryption</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, m: <span class="built_in">int</span>, fillchar: <span class="built_in">str</span>=<span class="string">&quot;z&quot;</span>, key: np.ndarray=<span class="literal">None</span></span>):</span></span><br><span class="line">        self.m = m</span><br><span class="line">        self.key = key</span><br><span class="line">        self.dicn2s = &#123;i: dic[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>)&#125;</span><br><span class="line">        self.dics2n = <span class="built_in">dict</span>(<span class="built_in">zip</span>(self.dicn2s.values(), self.dicn2s.keys()))</span><br><span class="line">        self.fillchar = self.dics2n[fillchar]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setM</span>(<span class="params">self, m: <span class="built_in">int</span></span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="keyword">assert</span> m &gt; <span class="number">0</span></span><br><span class="line">        self.m = m</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setKey</span>(<span class="params">self, key: np.ndarray=<span class="literal">None</span></span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">while</span> key <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> KeyEncryption.modInv(np.linalg.det(key)) == -<span class="number">1</span>:</span><br><span class="line">                key = np.random.randint(<span class="number">0</span>, <span class="number">65</span>, size=(self.m, self.m))</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;random matrix：\n&quot;</span>, key)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">assert</span> KeyEncryption.modInv(np.linalg.det(key)) != -<span class="number">1</span></span><br><span class="line">        self.key = key</span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">modInv</span>(<span class="params">x: <span class="built_in">int</span></span>):</span></span><br><span class="line">        y = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> y &lt; <span class="number">64</span>:</span><br><span class="line">            y += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> (x * y) % <span class="number">64</span> == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> y</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_loopCrypt</span>(<span class="params">self, long: np.ndarray, K: np.ndarray</span>) -&gt; np.ndarray:</span></span><br><span class="line">        ans = np.array([])</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(long.shape[<span class="number">0</span>] // self.m):</span><br><span class="line">            ans = np.mod(np.hstack((</span><br><span class="line">                ans, </span><br><span class="line">                np.dot(long[i*self.m:i*self.m+self.m], K)</span><br><span class="line">            )), <span class="number">64</span>)</span><br><span class="line">        <span class="keyword">return</span> ans.astype(np.int64)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">self, plaintext: np.ndarray</span>):</span></span><br><span class="line">        <span class="keyword">assert</span> self.m !=<span class="literal">None</span> <span class="keyword">and</span> self.key <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> plaintext.shape[<span class="number">0</span>] % self.m:</span><br><span class="line">            plaintext = np.hstack((</span><br><span class="line">                plaintext, </span><br><span class="line">                [self.fillchar] *(self.m - plaintext.shape[<span class="number">0</span>] % self.m)</span><br><span class="line">            ))</span><br><span class="line">        <span class="keyword">return</span> self._loopCrypt(plaintext, self.key)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">translate</span>(<span class="params">self, s, to: <span class="built_in">str</span></span>):</span></span><br><span class="line">        <span class="keyword">if</span> to == <span class="string">&quot;text&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join([self.dicn2s[si] <span class="keyword">for</span> si <span class="keyword">in</span> s])</span><br><span class="line">        <span class="keyword">elif</span> to == <span class="string">&quot;num&quot;</span>:</span><br><span class="line">            s = s.replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> np.array([self.dics2n[si] <span class="keyword">for</span> si <span class="keyword">in</span> s])</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getKey</span>(<span class="params">key</span>):</span></span><br><span class="line">  he = KeyEncryption(m=<span class="number">3</span>)</span><br><span class="line">  he.setKey()              </span><br><span class="line">  nums = he.translate(key, <span class="string">&quot;num&quot;</span>)</span><br><span class="line">  res = he.encrypt(nums)</span><br><span class="line">  enkey = <span class="string">&#x27;&#x27;</span>.join(dic[i] <span class="keyword">for</span> i <span class="keyword">in</span> res.tolist())</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&#x27;Encrypt key:&#x27;</span>,enkey)</span><br><span class="line">  <span class="keyword">return</span> enkey</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  fir1 = <span class="string">&#x27; &#x27;</span>.join(<span class="built_in">map</span>(<span class="keyword">lambda</span> _:_[::-<span class="number">1</span>],re.split(<span class="string">&quot;[ &#123; _ &#125; ]&quot;</span> , flag.swapcase())))</span><br><span class="line">  ciphertext1 = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  key = <span class="string">&quot;&quot;</span>  </span><br><span class="line">  enkey = getKey(key)</span><br><span class="line">  _enkey=[f1nd(i) <span class="keyword">for</span> i <span class="keyword">in</span> key]</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&#x27;key lengeh:&#x27;</span>,<span class="built_in">len</span>(_enkey))</span><br><span class="line">  j = <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> fir1:</span><br><span class="line">    <span class="keyword">if</span> f1nd(i)&gt;=<span class="number">0</span>:</span><br><span class="line">      ciphertext1 += dic[(f1nd(i) + _enkey[j % <span class="built_in">len</span>(_enkey)])%<span class="number">64</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      ciphertext1 += i</span><br><span class="line">    j += <span class="number">1</span></span><br><span class="line">  ciphertext = ciphertext1.replace(<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;_&#x27;</span>)</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&#x27;ciphertext:%s&#123;%s&#125;&#x27;</span> % (ciphertext[<span class="number">0</span>:<span class="number">5</span>],ciphertext[<span class="number">6</span>:-<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">flag length: 48</span></span><br><span class="line"><span class="string">random matrix：</span></span><br><span class="line"><span class="string"> [[13 37 10]</span></span><br><span class="line"><span class="string"> [15 17 41]</span></span><br><span class="line"><span class="string"> [13  0 10]]</span></span><br><span class="line"><span class="string">Encrypt key: pVvRe/G08rLhfwa</span></span><br><span class="line"><span class="string">key lengeh: 14</span></span><br><span class="line"><span class="string">ciphertext:1k2Pe&#123;24seBl4_a6Ot_fp7O1_eHk_Plg3EF_g/JtIonut4/&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="题解-10"><a href="#题解-10" class="headerlink" title="题解"></a>题解</h4><p>矩阵逆运算（chatgpt写的）恢复key，然后再恢复flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">dic = string.ascii_uppercase + string.ascii_lowercase + string.digits + <span class="string">&#x27;+/&#x27;</span></span><br><span class="line">f1nd = <span class="keyword">lambda</span> x: dic.find(x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KeyEncryption</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, m: <span class="built_in">int</span>, fillchar: <span class="built_in">str</span> = <span class="string">&quot;z&quot;</span>, key: np.ndarray = <span class="literal">None</span></span>):</span></span><br><span class="line">        self.m = m</span><br><span class="line">        self.key = key</span><br><span class="line">        self.dicn2s = &#123;i: dic[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>)&#125;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;self.dicn2s =&quot;</span>, self.dicn2s)</span><br><span class="line">        self.dics2n = <span class="built_in">dict</span>(<span class="built_in">zip</span>(self.dicn2s.values(), self.dicn2s.keys()))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;self.dics2n =&quot;</span>, self.dics2n)</span><br><span class="line">        self.fillchar = self.dics2n[fillchar]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;fillchar =&quot;</span>, self.fillchar)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setM</span>(<span class="params">self, m: <span class="built_in">int</span></span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="keyword">assert</span> m &gt; <span class="number">0</span></span><br><span class="line">        self.m = m</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setKey</span>(<span class="params">self, key: np.ndarray = <span class="literal">None</span></span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">while</span> key <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> KeyEncryption.modInv(np.linalg.det(key)) == -<span class="number">1</span>:</span><br><span class="line">                key = np.random.randint(<span class="number">0</span>, <span class="number">65</span>, size=(self.m, self.m))</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;random matrix：\n&quot;</span>, key)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">assert</span> KeyEncryption.modInv(np.linalg.det(key)) != -<span class="number">1</span></span><br><span class="line">        self.key = key</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">modInv</span>(<span class="params">x: <span class="built_in">int</span></span>):</span></span><br><span class="line">        y = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> y &lt; <span class="number">64</span>:</span><br><span class="line">            y += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> (x * y) % <span class="number">64</span> == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> y</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_loopCrypt</span>(<span class="params">self, long: np.ndarray, K: np.ndarray</span>) -&gt; np.ndarray:</span></span><br><span class="line">        ans = np.array([])</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(long.shape[<span class="number">0</span>] // self.m):</span><br><span class="line">            ans = np.mod(np.hstack((</span><br><span class="line">                ans,</span><br><span class="line">                np.dot(long[i * self.m:i * self.m + self.m], K)</span><br><span class="line">            )), <span class="number">64</span>)</span><br><span class="line">        <span class="keyword">return</span> ans.astype(np.int64)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">self, plaintext: np.ndarray</span>):</span></span><br><span class="line">        <span class="keyword">assert</span> self.m != <span class="literal">None</span> <span class="keyword">and</span> self.key <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> plaintext.shape[<span class="number">0</span>] % self.m:</span><br><span class="line">            plaintext = np.hstack((</span><br><span class="line">                plaintext,</span><br><span class="line">                [self.fillchar] * (self.m - plaintext.shape[<span class="number">0</span>] % self.m)</span><br><span class="line">            ))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;plaintext&quot;</span>, plaintext)</span><br><span class="line">        <span class="keyword">return</span> self._loopCrypt(plaintext, self.key)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">translate</span>(<span class="params">self, s, to: <span class="built_in">str</span></span>):</span></span><br><span class="line">        <span class="keyword">if</span> to == <span class="string">&quot;text&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join([self.dicn2s[si] <span class="keyword">for</span> si <span class="keyword">in</span> s])</span><br><span class="line">        <span class="keyword">elif</span> to == <span class="string">&quot;num&quot;</span>:</span><br><span class="line">            s = s.replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> np.array([self.dics2n[si] <span class="keyword">for</span> si <span class="keyword">in</span> s])</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">self, ciphertext: np.ndarray</span>) -&gt; <span class="built_in">str</span>:</span></span><br><span class="line">        self.key = np.array(  [[<span class="number">13</span>,<span class="number">37</span>,<span class="number">10</span>],[<span class="number">15</span>,<span class="number">17</span>,<span class="number">41</span>],[<span class="number">13</span>,<span class="number">0</span>,<span class="number">10</span>]])</span><br><span class="line">        <span class="keyword">assert</span> self.m <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> self.key <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span></span><br><span class="line">        plaintext = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        inv_key = KeyEncryption.modInv(np.linalg.det(self.key)) * np.<span class="built_in">round</span>(</span><br><span class="line">            np.linalg.inv(self.key) * np.linalg.det(self.key))</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(ciphertext.shape[<span class="number">0</span>] // self.m):</span><br><span class="line">            tmp = np.mod(np.dot(ciphertext[i * self.m:i * self.m + self.m], inv_key), <span class="number">64</span>)</span><br><span class="line">            plaintext += <span class="string">&#x27;&#x27;</span>.join([self.dicn2s[<span class="built_in">int</span>(tmp[j])] <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(self.m)])</span><br><span class="line">        plaintext = plaintext.rstrip(self.dicn2s[self.fillchar])</span><br><span class="line">        <span class="keyword">return</span> plaintext</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getKey</span>(<span class="params">key</span>):</span></span><br><span class="line">    he = KeyEncryption(m=<span class="number">3</span>)</span><br><span class="line">    he.setKey()</span><br><span class="line">    nums = he.translate(key, <span class="string">&quot;num&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;nums =&quot;</span>, nums)</span><br><span class="line"></span><br><span class="line">    res = he.encrypt(nums)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;res =&#x27;</span>, res)</span><br><span class="line">    enkey = <span class="string">&#x27;&#x27;</span>.join(dic[i] <span class="keyword">for</span> i <span class="keyword">in</span> res.tolist())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;res.tolist() =&quot;</span>,  res.tolist())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Encrypt key:&#x27;</span>, enkey)</span><br><span class="line">    <span class="keyword">return</span> enkey</span><br><span class="line"></span><br><span class="line">he = KeyEncryption(m=<span class="number">3</span>)</span><br><span class="line">enc_key = <span class="string">&#x27;pVvRe/G08rLhfwa&#x27;</span></span><br><span class="line">enc_key = [f1nd(i) <span class="keyword">for</span> i <span class="keyword">in</span> enc_key]</span><br><span class="line">enc_key = np.array(enc_key)</span><br><span class="line">key = he.decrypt(enc_key)</span><br><span class="line"><span class="built_in">print</span>(key)</span><br><span class="line">_enkey = [f1nd(i) <span class="keyword">for</span> i <span class="keyword">in</span> key]</span><br><span class="line"></span><br><span class="line">c = <span class="string">&#x27;1k2Pe&#123;24seBl4_a6Ot_fp7O1_eHk_Plg3EF_g/JtIonut4/&#125;&#x27;</span></span><br><span class="line">j = <span class="number">0</span></span><br><span class="line">tmp = &#123;&#125;</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> c:</span><br><span class="line">    <span class="keyword">if</span> f1nd(i) &gt;= <span class="number">0</span>:</span><br><span class="line">        <span class="comment"># tmp = (f1nd(i) + _enkey[j % len(_enkey)]) % 64</span></span><br><span class="line">        tmp = (f1nd(i) - _enkey[j % <span class="built_in">len</span>(_enkey)]) % <span class="number">64</span></span><br><span class="line">        flag += dic[tmp]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        flag += i</span><br><span class="line">    j += <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> flag.split(<span class="string">&#x27;_&#x27;</span>):</span><br><span class="line">    <span class="built_in">print</span>(i[::-<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;CISsALc&#x27;</span>[::-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 手动转向</span></span><br><span class="line">flag = <span class="string">&#x27;nkctf&#123;cLAsSIC_C0DE_D0L1S_ArE_R3A1LY_INT3REsTING&#125;&#x27;</span>.swapcase()</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># NKCTF&#123;ClaSsic_c0de_d0l1s_aRe_r3a1ly_int3reSting&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Raven"><a href="#Raven" class="headerlink" title="Raven"></a>Raven</h3><h4 id="题目-11"><a href="#题目-11" class="headerlink" title="题目"></a>题目</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"><span class="comment"># Problem by rec, with a bad raven.</span></span><br><span class="line"><span class="keyword">import</span> os, hashlib</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Raven</span>(<span class="params">n: <span class="built_in">int</span>, secret: <span class="built_in">bytes</span></span>):</span></span><br><span class="line">    H = <span class="keyword">lambda</span> x: hashlib.md5(os.urandom(<span class="number">8</span>) + x).digest()</span><br><span class="line"></span><br><span class="line">    p = getPrime(<span class="number">728</span>)</span><br><span class="line">    R.&lt;z&gt; = PolynomialRing(GF(p))</span><br><span class="line"></span><br><span class="line">    seed = H(secret)</span><br><span class="line">    f = R(</span><br><span class="line">        [bytes_to_long(secret)] + [bytes_to_long(H(seed)) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n - <span class="number">1</span>)]</span><br><span class="line">    )</span><br><span class="line">    x = [getRandomRange(<span class="number">2</span>, p - <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">    y = [ZZ(f(xi)^<span class="number">2</span> + getPrime(<span class="number">256</span>)) <span class="keyword">for</span> xi <span class="keyword">in</span> x]</span><br><span class="line"></span><br><span class="line">    pairs = <span class="built_in">list</span>(<span class="built_in">zip</span>(x, y))</span><br><span class="line">    <span class="keyword">return</span> p, pairs</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&#x27;#####&#x27;</span></span><br><span class="line">key = os.urandom(<span class="number">16</span>)</span><br><span class="line">cipher = AES.new(key=key, IV=<span class="built_in">bytes</span>(<span class="built_in">range</span>(<span class="number">16</span>)), mode=AES.MODE_CBC)</span><br><span class="line">ct = cipher.encrypt(flag + os.urandom(<span class="number">16</span> - <span class="built_in">len</span>(flag) % <span class="number">16</span>))</span><br><span class="line">p, pairs = Raven(<span class="number">4</span>, key)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;p = &#125;</span>\n<span class="subst">&#123;pairs = &#125;</span>\n<span class="subst">&#123;ct = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">p = 1018551160851728231474335384388576586031917743463656622083024684199383855595168341728561337234276243780407755294430553694832049089534855113774546001494743212076463713621965520780122783825100696968959866614846174188401153</span></span><br><span class="line"><span class="string">pairs = [(615358616404864757405587650175842125441380884418119777842292095751090237848084440177153221092040264723889917863863854377665802549748720692225139890884830475485512763149974948701807492663962748292710803434009673589337265, 84982753624462868217739962129526665082932464631118597651920986288766037499319751354013335054886685186857222944776560264528363811382359242656883760986496856164448940929282013856762706210675691655747370624405968909408102), (528363810186974800127873139379943131424126521611531830591311656948009967709310974894584084912262479395720199930206495204352231804549705720854271566421006481173043064265399467682307971910488405265826107365679757755866812, 496810092723839642457928776423789418365006215801711874210443222720529161066621876103037104247173440072986344011599384793861949574577559989016501090247331146721371126871470611440468688947950954988175225633457347666551944), (68711183101845981499596464753252121346970486988311398916877579778110690480447199642602267233989256728822535174215153145632158860662954277116345331672194812126361911061449082917955000137698138358926301360506687271134873, 995428771589393162202488762223106955302099250561593105620410424291405842350539887383005328242236156038373244928147473800972534658018117705291472213770335998508454938607290279268848513727721410314612261163489156360908800), (61574167546312883246262193556029081771904529137922128124933785599227801608271357738142074310192454183183340219301304405636497744152219785042075198056952749425345561162612590170550454476602892138914473795478531165181812, 618169326093802548516842299173393893046765466917311052414967158839652012130855552015876657514610755108820971877570295328618373296493668146691687291894702228119875561585283226588768969944781923428807766632578060221034862)]</span></span><br><span class="line"><span class="string">ct = b&quot;|2\xf0v7\x05Y\x89\r]\xe93s\rr)#3\xe9\x90%Z\x9a\xd9\x9ck\xba\xec]q\xb8\xf2&#x27;\xc8e~fL\xcf\x93\x00\xd6^s-\xc9\xd6M&quot;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="题解-11"><a href="#题解-11" class="headerlink" title="题解"></a>题解</h4><p>起初见到这题，一直在想是否存在不用格的巧妙解法，有些本能的回避格了。</p>
<p>最后无可奈何了才想着用格来解决这类似门限方案的问题。</p>
<p>问题核心如下:</p>
<p>定义函数：$f(x) = ax^3+bx^2+cx+d \mod p$</p>
<p>记<code>getPrime(256)</code>为t，题目给出p、四组x以及对应的$f(x_i)^2+t_i \mod p$， 即：<br>$$<br>\begin{aligned} y_i &amp;= f(x_i)^2+t_i \\ &amp;= a^2x_i^6+2abx_i^5+(b^2+2ac)x_i^4+(2bcd+2ad)x_i^3+(c^2+2bd)x_i^2+2cdx_i + d^2 + t_i \mod p  \end{aligned}<br>$$<br>也即：<br>$$<br>\begin{aligned} a^2x_i^6+2abx_i^5+(b^2+2ac)x_i^4+(2bcd+2ad)x_i^3+(c^2+2bd)x_i^2+2cdx_i + d^2 -y_i +kp &amp;= -t_i \end{aligned}<br>$$<br>起初如下构造了格：<br>$$<br>\begin{bmatrix} d^2 &amp; 2cd &amp; c^2+2bd &amp; 2bcd+2ad &amp; b^2+2ac &amp; 2ab &amp; a^2 &amp; 1 &amp;k_1 &amp; \cdots &amp; k_4 \end{bmatrix} \begin{bmatrix} x_1^0 &amp; \cdots &amp; x_4^0 \\ x_1^1 &amp; \cdots &amp; x_4^1 \\ \vdots &amp; \cdots &amp; \vdots \\ x_1^6 &amp; \cdots &amp; x_4^6 \\ -y_1 &amp; \cdots &amp; -y_4 \\ p \\ &amp; \ddots \\ &amp; &amp; p \end{bmatrix} = \begin{bmatrix} -t_1 &amp; -t_2 &amp; -t_3 &amp; -t_4 \end{bmatrix}<br>$$<br>格构造的特别狭长，结果当然是规约失败了。</p>
<p>现想来这种非满秩的矩阵，LLL规约效果等效于用0填充成方阵后的效果。</p>
<p>赛时来不及细想，想起之前赛事第一次遇见门限方案时，我是用crt解的，其后看到<a target="_blank" rel="noopener" href="https://hash-hash.github.io/2022/11/27/HITCON2022-Crypto/">hash师傅的格解法</a>，没细究。</p>
<p>这次卡住了便再去学习了格的构造，最后得到：<br>$$<br>\begin{bmatrix} d^2 &amp; 2cd &amp; \cdots &amp; b^2+2ac &amp; 2ab &amp; a^2 &amp; 1 &amp;k_1 &amp; \cdots &amp; k_4 \end{bmatrix}<br>\begin{bmatrix} 1 &amp;  &amp;  &amp; &amp; x_1^0 &amp; \cdots &amp; x_4^0 \\ &amp; \ddots &amp; &amp; &amp; \vdots &amp; \vdots &amp; \vdots \\ &amp; &amp; 1 &amp; &amp;  x_1^6 &amp; \cdots &amp; x_4^6 \\ &amp; &amp; &amp; 2^{256} &amp; -y_1 &amp; \cdots &amp; -y_4 \\ &amp;&amp;&amp;&amp;p \\ &amp;&amp;&amp;&amp;&amp; \ddots \\ &amp; &amp;&amp;&amp;&amp;&amp; p \end{bmatrix}<br>=<br>\begin{bmatrix} d^2 &amp; 2cd &amp; \cdots &amp; b^2+2ac &amp; 2ab &amp; a^2 &amp; 2^{256} &amp;-t_1 &amp; \cdots &amp; -t_4 \end{bmatrix}<br>$$<br>（还是生疏，说来就是一开始的格忘记加单位矩阵了…）</p>
<p>本地实际测试，发现得到的$d^2$不太准确。</p>
<p>但$a^2,2ab,2cd$都是准确的，那么就可以间接求出d了。</p>
<p>再接下来就是常规的AES解密，总exp如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum, gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">p = <span class="number">1018551160851728231474335384388576586031917743463656622083024684199383855595168341728561337234276243780407755294430553694832049089534855113774546001494743212076463713621965520780122783825100696968959866614846174188401153</span></span><br><span class="line">pairs = [(<span class="number">615358616404864757405587650175842125441380884418119777842292095751090237848084440177153221092040264723889917863863854377665802549748720692225139890884830475485512763149974948701807492663962748292710803434009673589337265</span>, <span class="number">84982753624462868217739962129526665082932464631118597651920986288766037499319751354013335054886685186857222944776560264528363811382359242656883760986496856164448940929282013856762706210675691655747370624405968909408102</span>), (<span class="number">528363810186974800127873139379943131424126521611531830591311656948009967709310974894584084912262479395720199930206495204352231804549705720854271566421006481173043064265399467682307971910488405265826107365679757755866812</span>, <span class="number">496810092723839642457928776423789418365006215801711874210443222720529161066621876103037104247173440072986344011599384793861949574577559989016501090247331146721371126871470611440468688947950954988175225633457347666551944</span>), (<span class="number">68711183101845981499596464753252121346970486988311398916877579778110690480447199642602267233989256728822535174215153145632158860662954277116345331672194812126361911061449082917955000137698138358926301360506687271134873</span>, <span class="number">995428771589393162202488762223106955302099250561593105620410424291405842350539887383005328242236156038373244928147473800972534658018117705291472213770335998508454938607290279268848513727721410314612261163489156360908800</span>), (<span class="number">61574167546312883246262193556029081771904529137922128124933785599227801608271357738142074310192454183183340219301304405636497744152219785042075198056952749425345561162612590170550454476602892138914473795478531165181812</span>, <span class="number">618169326093802548516842299173393893046765466917311052414967158839652012130855552015876657514610755108820971877570295328618373296493668146691687291894702228119875561585283226588768969944781923428807766632578060221034862</span>)]</span><br><span class="line">ct = <span class="string">b&quot;|2\xf0v7\x05Y\x89\r]\xe93s\rr)#3\xe9\x90%Z\x9a\xd9\x9ck\xba\xec]q\xb8\xf2&#x27;\xc8e~fL\xcf\x93\x00\xd6^s-\xc9\xd6M&quot;</span></span><br><span class="line"></span><br><span class="line">L=Matrix(ZZ,<span class="number">12</span>,<span class="number">12</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    L[i,i]=<span class="number">1</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">        L[j,<span class="number">8</span>+i]=pairs[i][<span class="number">0</span>]^(j)</span><br><span class="line"></span><br><span class="line">tmp = <span class="number">2</span>^<span class="number">256</span></span><br><span class="line"></span><br><span class="line">L[<span class="number">7</span>,<span class="number">7</span>]=tmp</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    L[<span class="number">7</span>,i+<span class="number">8</span>]=-pairs[i][<span class="number">1</span>]</span><br><span class="line">    L[<span class="number">8</span>+i,<span class="number">8</span>+i]=p</span><br><span class="line">L = L.LLL()[<span class="number">1</span>]</span><br><span class="line">a = <span class="built_in">int</span>(gmpy2.iroot(<span class="built_in">abs</span>(L[<span class="number">6</span>]), <span class="number">2</span>)[<span class="number">0</span>])</span><br><span class="line">b = <span class="built_in">abs</span>(L[<span class="number">5</span>])//(<span class="number">2</span>*a)</span><br><span class="line">c = (<span class="built_in">abs</span>(L[<span class="number">4</span>])-b^<span class="number">2</span>)//(<span class="number">2</span>*a)</span><br><span class="line">d = <span class="built_in">abs</span>(L[<span class="number">1</span>])//(<span class="number">2</span>*c)</span><br><span class="line">key = libnum.n2s(<span class="built_in">int</span>(d))</span><br><span class="line">cipher = AES.new(key=key, IV=<span class="built_in">bytes</span>(<span class="built_in">range</span>(<span class="number">16</span>)), mode=AES.MODE_CBC)</span><br><span class="line"><span class="built_in">print</span>(cipher.decrypt(ct))</span><br><span class="line"><span class="comment"># nkctf&#123;..escape..&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="PsychoRandom-Unsolved"><a href="#PsychoRandom-Unsolved" class="headerlink" title="PsychoRandom (Unsolved)"></a>PsychoRandom (Unsolved)</h3><h4 id="题目-12"><a href="#题目-12" class="headerlink" title="题目"></a>题目</h4><p><strong>task.py</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># Problem by rec, with a toy generator.</span></span><br><span class="line"><span class="keyword">import</span> os, utils</span><br><span class="line"></span><br><span class="line">seed = <span class="built_in">int</span>(os.urandom(<span class="number">16</span>).<span class="built_in">hex</span>(), <span class="number">16</span>)</span><br><span class="line">gen = utils.ToyGen(seed)</span><br><span class="line"></span><br><span class="line">sec = <span class="string">b&#x27;#####&#x27;</span></span><br><span class="line"><span class="keyword">assert</span> <span class="string">b&#x27;nkctf&#x27;</span> <span class="keyword">in</span> sec</span><br><span class="line"></span><br><span class="line">msg = <span class="string">b&#x27;##MSG FROM NK: &#x27;</span> + sec</span><br><span class="line">enc = <span class="built_in">bytes</span>(m ^ <span class="built_in">next</span>(gen) <span class="keyword">for</span> m <span class="keyword">in</span> msg).<span class="built_in">hex</span>()</span><br><span class="line"><span class="built_in">print</span>(enc)</span><br><span class="line"><span class="comment"># 9c1250e1fefb6012cf74a7fd0156cd1a2817ee9381d086a1561399f5b7f519e5abf4437739fa254cd35b241375292d73aa8b8e6ff61f4977da3c68a699156e6bfbe2c38d7b08eed07e40e831c25f5327a21847bb156060228e2b</span></span><br></pre></td></tr></table></figure>

<p><strong>utils.py</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ToyGen</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, state</span>):</span></span><br><span class="line">        self.nbits = <span class="number">128</span></span><br><span class="line">        self.state = state &amp; ((<span class="number">1</span> &lt;&lt; self.nbits) - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        self.mask = <span class="number">230336355081348639216651218083300669636</span></span><br><span class="line"></span><br><span class="line">        self.alpha = <span class="number">237299571639771708626086074576623691999</span></span><br><span class="line">        self.beta = <span class="number">83015690654496181240783151904447565127</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func0</span>(<span class="params">self, steps=<span class="number">1</span></span>):</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(steps):</span><br><span class="line">            res = self.state &amp; self.mask</span><br><span class="line">            bit = <span class="built_in">sum</span>([(res &gt;&gt; i) &amp; <span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.nbits)]) &amp; <span class="number">1</span></span><br><span class="line">            self.state = ((self.state &lt;&lt; <span class="number">1</span>) ^ bit) &amp; ((<span class="number">1</span> &lt;&lt; self.nbits) - <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func1</span>(<span class="params">self</span>):</span></span><br><span class="line">        res = (self.state ^ self.beta) &amp; self.alpha</span><br><span class="line">        bit = <span class="built_in">sum</span>([(res &gt;&gt; i) &amp; <span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.nbits)]) &amp; <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> bit</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__next__</span>(<span class="params">self</span>):</span></span><br><span class="line">        out = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">            self.func0(<span class="number">37</span>)</span><br><span class="line">            bit = self.func1()</span><br><span class="line">            out = (out &lt;&lt; <span class="number">1</span>) ^ bit</span><br><span class="line">        <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>

<h4 id="题解-12"><a href="#题解-12" class="headerlink" title="题解"></a>题解</h4><p>差这道AK密码也因此队伍无缘总分第一，有些遗憾。</p>
<p>但反思起来，无论是平日知识学习还是赛事训练确实都或有意无意的回避流密码。</p>
<p>也没啥好回避的，学！</p>
<p><img src="https://cdn.jsdelivr.net/gh/Harry0597/Imag@master/uPic/92f69d3a8ec71c500f531642edbc4711.png" alt="官方题解"></p>
<p>比赛的最后阶段，瞪了这题四小时，赛时也发现了如下这点<br>$$<br>out =  \sum\limits^{n} _ {i=1} (s_i \oplus b_i) \&amp; a_i =  (\sum\limits^{n} _ {i=1} s_i \&amp; a_i) \oplus (\sum\limits^{n} _ {i=1} b_i \&amp; a_i)<br>$$<br>($\sum \limits^{n} _ {i=1} (s_i \oplus b_i) \&amp; a_i$表示 <strong>s的第i位</strong> 与 <strong>b的第i位</strong> 异或 后再与 <strong>a的第i位</strong>进行 与运算 再把i从1到n的结果在GF(2)上求和)</p>
<p>记$\sum\limits^{n} _ {i=1} s_i \&amp; a_i$为out’，则:<br>$$<br>out’ = \sum\limits^{n} _ {i=1} s_i \&amp; a_i = out \oplus (\sum\limits^{n} _ {i=1} b_i \&amp; a_i) = out \oplus 1<br>$$<br>(题目中a, b固定，能计算确定$\sum\limits^{n} _ {i=1} b_i \&amp; a_i=1$)</p>
<p>赛时到这一步便卡死了，确实发现异或beta的效果等效于不异或的结果取反，但不知道如何用多组 <strong>每刷新37次状态再给出的out</strong> 来恢复某一时刻的状态。</p>
<p>看到官方wp思路用的是矩阵，也释然了。</p>
<p>其实能想到要用矩阵、多项式来描述、求解问题，但平时只做<a target="_blank" rel="noopener" href="https://ctf-wiki.org/crypto/streamcipher/fsr/lfsr/">理论学习</a>没怎么实际训练，赛时会<strong>不敢想、不敢用</strong>。</p>
<p>实际代码编写，再学习<a target="_blank" rel="noopener" href="https://jayxv.github.io/2020/12/18/密码学学习笔记之CTF/">Van1sh师傅博客相关内容</a>就行。</p>
<h5 id="求解所有可能seed（初始状态）"><a href="#求解所有可能seed（初始状态）" class="headerlink" title="求解所有可能seed（初始状态）"></a>求解所有可能seed（初始状态）</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># SageMath</span></span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line">n = <span class="number">128</span></span><br><span class="line">msg = <span class="string">b&#x27;##MSG FROM NK: &#x27;</span></span><br><span class="line">mask = <span class="number">230336355081348639216651218083300669636</span></span><br><span class="line">alpha = <span class="number">237299571639771708626086074576623691999</span></span><br><span class="line">enc = <span class="string">&#x27;9c1250e1fefb6012cf74a7fd0156cd1a2817ee9381d086a1561399f5b7f519e5abf4437739fa254cd35b241375292d73aa8b8e6ff61f4977da3c68a699156e6bfbe2c38d7b08eed07e40e831c25f5327a21847bb156060228e2b&#x27;</span></span><br><span class="line">enc = <span class="built_in">bytes</span>.fromhex(enc)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建M矩阵</span></span><br><span class="line">M = matrix(GF(<span class="number">2</span>), n, n)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">    <span class="keyword">if</span> i+<span class="number">1</span>&lt;n:</span><br><span class="line">        M[i+<span class="number">1</span>, i] = <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> mask&amp;(<span class="number">1</span>&lt;&lt;(n-i-<span class="number">1</span>)):</span><br><span class="line">        M[i, -<span class="number">1</span>] = <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        M[i, -<span class="number">1</span>] = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建T向量</span></span><br><span class="line">T = vector(GF(<span class="number">2</span>),n)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">    <span class="keyword">if</span> alpha&amp;(<span class="number">1</span>&lt;&lt;(n-i-<span class="number">1</span>)):</span><br><span class="line">        T[i] = <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        T[i] = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"><span class="comment"># 求解S，构建M2矩阵</span></span><br><span class="line"><span class="comment"># S*M2 = output_</span></span><br><span class="line">M2 = matrix(GF(<span class="number">2</span>), n, n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>):  <span class="comment"># 128！不是128//8 或者 len(msg)</span></span><br><span class="line">    tmp = M^(<span class="number">37</span>*(i+<span class="number">1</span>))*T</span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        M2[y, i] = tmp[y]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建output_s矩阵</span></span><br><span class="line">output_s_base = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(msg)):</span><br><span class="line">    tmp = msg[i]^^enc[i]</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        <span class="keyword">if</span> tmp&amp;(<span class="number">1</span>&lt;&lt;(<span class="number">8</span>-x-<span class="number">1</span>)):  <span class="comment"># 因为beta,取反</span></span><br><span class="line">            output_s_base.append(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            output_s_base.append(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 爆破后8位，得到所有可能初始状态</span></span><br><span class="line">Ss = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>&lt;&lt;<span class="number">8</span>):</span><br><span class="line">    output_s = [i <span class="keyword">for</span> i <span class="keyword">in</span> output_s_base]</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        <span class="keyword">if</span> i&amp;(<span class="number">1</span>&lt;&lt;(<span class="number">8</span>-x-<span class="number">1</span>)):</span><br><span class="line">            output_s.append(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            output_s.append(<span class="number">0</span>)</span><br><span class="line">    output_s = vector(GF(<span class="number">2</span>), output_s)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        S = M2.solve_left(output_s)</span><br><span class="line">        Ss.append(<span class="built_in">list</span>(S))</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"><span class="comment"># print(Ss)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 转换为整数</span></span><br><span class="line">seeds = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> Ss:</span><br><span class="line">    seed = <span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join([<span class="built_in">str</span>(each) <span class="keyword">for</span> each <span class="keyword">in</span> i]), <span class="number">2</span>)</span><br><span class="line">    seeds.append(seed)</span><br><span class="line"><span class="built_in">print</span>(seeds)</span><br></pre></td></tr></table></figure>

<h5 id="求解flag"><a href="#求解flag" class="headerlink" title="求解flag"></a>求解flag</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os, utils</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"></span><br><span class="line">enc = <span class="string">&#x27;9c1250e1fefb6012cf74a7fd0156cd1a2817ee9381d086a1561399f5b7f519e5abf4437739fa254cd35b241375292d73aa8b8e6ff61f4977da3c68a699156e6bfbe2c38d7b08eed07e40e831c25f5327a21847bb156060228e2b&#x27;</span></span><br><span class="line">enc = <span class="built_in">bytes</span>.fromhex(enc)</span><br><span class="line">seeds = []  <span class="comment"># seeds复制过来</span></span><br><span class="line"><span class="keyword">for</span> seed <span class="keyword">in</span> tqdm(seeds):</span><br><span class="line">    gen = utils.ToyGen(seed)</span><br><span class="line">    flag = <span class="built_in">bytes</span>(c ^ <span class="built_in">next</span>(gen) <span class="keyword">for</span> c <span class="keyword">in</span> enc)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;nkctf&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="comment"># b&#x27;##MSG FROM NK: Congratulations! Hope you enjoy the game and your flag is: nkctf&#123;ez-got-it&#125;&#x27;</span></span><br><span class="line"><span class="comment"># nkctf&#123;ez-got-it&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/Harry0597/Imag@master/uPic/12bbf71421706859cde23cac65ed54ba.png" alt="12bbf71421706859cde23cac65ed54ba"></p>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>星盟安全团队纳新！</p>
<p>欢迎师傅们加群（346014666）学习、讨论！</p>
<p><img src="https://cdn.jsdelivr.net/gh/Harry0597/Imag@master/uPic/d7e91f0fae5b720a917565d0be956497.png" alt="xmcve"></p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Harry0597
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://harry0597.com/2023/03/30/NKCTF2023/" title="NKCTF2023·Crypto WP">https://harry0597.com/2023/03/30/NKCTF2023/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Writeup/" rel="tag"><i class="fa fa-tag"></i> Writeup</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/02/09/%E5%88%9D%E6%8E%A2%E6%A0%BC%E5%AF%86%E7%A0%81/" rel="prev" title="初探格密码">
      <i class="fa fa-chevron-left"></i> 初探格密码
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#NKCTF2023"><span class="nav-number">1.</span> <span class="nav-text">NKCTF2023</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Crypto"><span class="nav-number">1.1.</span> <span class="nav-text">Crypto</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#baby-RSA"><span class="nav-number">1.1.1.</span> <span class="nav-text">baby_RSA</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE"><span class="nav-number">1.1.1.1.</span> <span class="nav-text">题目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3"><span class="nav-number">1.1.1.2.</span> <span class="nav-text">题解</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ez-math"><span class="nav-number">1.1.2.</span> <span class="nav-text">ez_math</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE-1"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">题目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3-1"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">题解</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ezRSA"><span class="nav-number">1.1.3.</span> <span class="nav-text">ezRSA</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE-2"><span class="nav-number">1.1.3.1.</span> <span class="nav-text">题目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3-2"><span class="nav-number">1.1.3.2.</span> <span class="nav-text">题解</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#real-MT"><span class="nav-number">1.1.4.</span> <span class="nav-text">real_MT</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE-3"><span class="nav-number">1.1.4.1.</span> <span class="nav-text">题目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3-3"><span class="nav-number">1.1.4.2.</span> <span class="nav-text">题解</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#fake-MT"><span class="nav-number">1.1.5.</span> <span class="nav-text">fake_MT</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE-4"><span class="nav-number">1.1.5.1.</span> <span class="nav-text">题目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3-4"><span class="nav-number">1.1.5.2.</span> <span class="nav-text">题解</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ez-polynomial"><span class="nav-number">1.1.6.</span> <span class="nav-text">ez_polynomial</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE-5"><span class="nav-number">1.1.6.1.</span> <span class="nav-text">题目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3-5"><span class="nav-number">1.1.6.2.</span> <span class="nav-text">题解</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#eZ-Bl%E2%8A%95ck"><span class="nav-number">1.1.7.</span> <span class="nav-text">eZ_Bl⊕ck</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE-6"><span class="nav-number">1.1.7.1.</span> <span class="nav-text">题目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3-6"><span class="nav-number">1.1.7.2.</span> <span class="nav-text">题解</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#easy-high"><span class="nav-number">1.1.8.</span> <span class="nav-text">easy_high</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE-7"><span class="nav-number">1.1.8.1.</span> <span class="nav-text">题目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3-7"><span class="nav-number">1.1.8.2.</span> <span class="nav-text">题解</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#eZ-LargeCG"><span class="nav-number">1.1.9.</span> <span class="nav-text">eZ_LargeCG</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE-8"><span class="nav-number">1.1.9.1.</span> <span class="nav-text">题目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3-8"><span class="nav-number">1.1.9.2.</span> <span class="nav-text">题解</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#complex-matrix"><span class="nav-number">1.1.10.</span> <span class="nav-text">complex_matrix</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE-9"><span class="nav-number">1.1.10.1.</span> <span class="nav-text">题目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3-9"><span class="nav-number">1.1.10.2.</span> <span class="nav-text">题解</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#baby-classical"><span class="nav-number">1.1.11.</span> <span class="nav-text">baby_classical</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE-10"><span class="nav-number">1.1.11.1.</span> <span class="nav-text">题目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3-10"><span class="nav-number">1.1.11.2.</span> <span class="nav-text">题解</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Raven"><span class="nav-number">1.1.12.</span> <span class="nav-text">Raven</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE-11"><span class="nav-number">1.1.12.1.</span> <span class="nav-text">题目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3-11"><span class="nav-number">1.1.12.2.</span> <span class="nav-text">题解</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PsychoRandom-Unsolved"><span class="nav-number">1.1.13.</span> <span class="nav-text">PsychoRandom (Unsolved)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE-12"><span class="nav-number">1.1.13.1.</span> <span class="nav-text">题目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3-12"><span class="nav-number">1.1.13.2.</span> <span class="nav-text">题解</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B1%82%E8%A7%A3%E6%89%80%E6%9C%89%E5%8F%AF%E8%83%BDseed%EF%BC%88%E5%88%9D%E5%A7%8B%E7%8A%B6%E6%80%81%EF%BC%89"><span class="nav-number">1.1.13.2.1.</span> <span class="nav-text">求解所有可能seed（初始状态）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B1%82%E8%A7%A3flag"><span class="nav-number">1.1.13.2.2.</span> <span class="nav-text">求解flag</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%99%E5%9C%A8%E6%9C%80%E5%90%8E"><span class="nav-number">1.2.</span> <span class="nav-text">写在最后</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Harry0597"
      src="/images/IMG_2550.JPG">
  <p class="site-author-name" itemprop="name">Harry0597</p>
  <div class="site-description" itemprop="description">Pondering'll do you wonders.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">48</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="sidebar-button motion-element"><i class="fa fa-comment"></i>
    Chat
  </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="mailto:1915885792@qq.com" title="E-Mail → mailto:1915885792@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>


      
        <script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script>
        <script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script>
        <div class="widget-wrap">
          <h3 class="widget-title">Tag Cloud</h3>
          <div id="myCanvasContainer" class="widget tagcloud">
              <canvas width="250" height="250" id="resCanvas" style="width=100%">
                  <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CS/" rel="tag">CS</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Crypto/" rel="tag">Crypto</a><span class="tag-list-count">19</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mac-OS/" rel="tag">Mac OS</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Misc/" rel="tag">Misc</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Writeup/" rel="tag">Writeup</a><span class="tag-list-count">18</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9D%82/" rel="tag">杂</a><span class="tag-list-count">6</span></li></ul>
              </canvas>
          </div>
        </div>
      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Harry0597</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">1.1m</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/three-waves.min.js"></script>
    <script defer src="/lib/three/canvas_lines.min.js"></script>
    <script defer src="/lib/three/canvas_sphere.min.js"></script>


  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'SdJfKJYPhm2sNuw1OsouUSUC-MdYXbMMI',
      appKey     : '4pmiJGkm87YwJe40oBXXWYKM',
      placeholder: "评论，让思维碰撞",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : 'https://SdJfKJYP.api.lncldglobal.com'
    });
  }, window.Valine);
});
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true}});</script></body>
</html>
